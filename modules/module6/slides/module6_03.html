<!DOCTYPE html>
<html lang="en"><head>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script><script src="../../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../../site_libs/quarto-html/tabby.min.js"></script>
<script src="../../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../../site_libs/quarto-html/tippy.umd.min.js"></script>
<link href="../../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../../site_libs/quarto-html/light-border.css" rel="stylesheet">
<link href="../../../site_libs/quarto-html/quarto-syntax-highlighting-2fa0555fe88427c29efa1b60aaf9e62d.css" rel="stylesheet" id="quarto-text-highlighting-styles"><meta charset="utf-8">
  <meta name="generator" content="quarto-1.6.42">

  <title>Data Visualization – Visualizing Geographic Data</title>
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, minimal-ui">
  <link rel="stylesheet" href="../../../site_libs/revealjs/dist/reset.css">
  <link rel="stylesheet" href="../../../site_libs/revealjs/dist/reveal.css">
  <style>
    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    div.columns{display: flex; gap: min(4vw, 1.5em);}
    div.column{flex: auto; overflow-x: auto;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    ul.task-list{list-style: none;}
    ul.task-list li input[type="checkbox"] {
      width: 0.8em;
      margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
      vertical-align: middle;
    }
    /* CSS for syntax highlighting */
    pre > code.sourceCode { white-space: pre; position: relative; }
    pre > code.sourceCode > span { line-height: 1.25; }
    pre > code.sourceCode > span:empty { height: 1.2em; }
    .sourceCode { overflow: visible; }
    code.sourceCode > span { color: inherit; text-decoration: inherit; }
    div.sourceCode { margin: 1em 0; }
    pre.sourceCode { margin: 0; }
    @media screen {
    div.sourceCode { overflow: auto; }
    }
    @media print {
    pre > code.sourceCode { white-space: pre-wrap; }
    pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
    }
    pre.numberSource code
      { counter-reset: source-line 0; }
    pre.numberSource code > span
      { position: relative; left: -4em; counter-increment: source-line; }
    pre.numberSource code > span > a:first-child::before
      { content: counter(source-line);
        position: relative; left: -1em; text-align: right; vertical-align: baseline;
        border: none; display: inline-block;
        -webkit-touch-callout: none; -webkit-user-select: none;
        -khtml-user-select: none; -moz-user-select: none;
        -ms-user-select: none; user-select: none;
        padding: 0 4px; width: 4em;
      }
    pre.numberSource { margin-left: 3em;  padding-left: 4px; }
    div.sourceCode
      { color: #383a42;  }
    @media screen {
    pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
    }
    code span { color: #383a42; } /* Normal */
    code span.al { color: #95da4c; background-color: #4d1f24; font-weight: bold; } /* Alert */
    code span.an { color: #50a14f; } /* Annotation */
    code span.at { color: #a626a4; } /* Attribute */
    code span.bn { color: #986801; } /* BaseN */
    code span.bu { color: #a626a4; } /* BuiltIn */
    code span.cf { color: #a626a4; } /* ControlFlow */
    code span.ch { color: #50a14f; } /* Char */
    code span.cn { color: #986801; } /* Constant */
    code span.co { color: #a0a1a7; font-style: italic; } /* Comment */
    code span.cv { color: #e45649; font-style: italic; } /* CommentVar */
    code span.do { color: #e45649; } /* Documentation */
    code span.dt { color: #a626a4; } /* DataType */
    code span.dv { color: #986801; } /* DecVal */
    code span.er { color: #f44747; text-decoration: underline; } /* Error */
    code span.ex { color: #4078f2; font-weight: bold; } /* Extension */
    code span.fl { color: #986801; } /* Float */
    code span.fu { color: #4078f2; } /* Function */
    code span.im { color: #50a14f; } /* Import */
    code span.in { color: #c45b00; } /* Information */
    code span.kw { color: #a626a4; } /* Keyword */
    code span.op { color: #a626a4; } /* Operator */
    code span.ot { color: #27ae60; } /* Other */
    code span.pp { color: #a626a4; } /* Preprocessor */
    code span.re { color: #2980b9; background-color: #153042; } /* RegionMarker */
    code span.sc { color: #0184bc; } /* SpecialChar */
    code span.ss { color: #da4453; } /* SpecialString */
    code span.st { color: #50a14f; } /* String */
    code span.va { color: #e45649; } /* Variable */
    code span.vs { color: #da4453; } /* VerbatimString */
    code span.wa { color: #da4453; } /* Warning */
  </style>
  <link rel="stylesheet" href="../../../site_libs/revealjs/dist/theme/quarto-49c57219293d8fab0ee09da3582d89ec.css">
  <link href="../../../site_libs/revealjs/plugin/quarto-line-highlight/line-highlight.css" rel="stylesheet">
  <link href="../../../site_libs/revealjs/plugin/reveal-menu/menu.css" rel="stylesheet">
  <link href="../../../site_libs/revealjs/plugin/reveal-menu/quarto-menu.css" rel="stylesheet">
  <link href="../../../site_libs/revealjs/plugin/quarto-support/footer.css" rel="stylesheet">
  <style type="text/css">
    .reveal div.sourceCode {
      margin: 0;
      overflow: auto;
    }
    .reveal div.hanging-indent {
      margin-left: 1em;
      text-indent: -1em;
    }
    .reveal .slide:not(.center) {
      height: 100%;
    }
    .reveal .slide.scrollable {
      overflow-y: auto;
    }
    .reveal .footnotes {
      height: 100%;
      overflow-y: auto;
    }
    .reveal .slide .absolute {
      position: absolute;
      display: block;
    }
    .reveal .footnotes ol {
      counter-reset: ol;
      list-style-type: none; 
      margin-left: 0;
    }
    .reveal .footnotes ol li:before {
      counter-increment: ol;
      content: counter(ol) ". "; 
    }
    .reveal .footnotes ol li > p:first-child {
      display: inline-block;
    }
    .reveal .slide ul,
    .reveal .slide ol {
      margin-bottom: 0.5em;
    }
    .reveal .slide ul li,
    .reveal .slide ol li {
      margin-top: 0.4em;
      margin-bottom: 0.2em;
    }
    .reveal .slide ul[role="tablist"] li {
      margin-bottom: 0;
    }
    .reveal .slide ul li > *:first-child,
    .reveal .slide ol li > *:first-child {
      margin-block-start: 0;
    }
    .reveal .slide ul li > *:last-child,
    .reveal .slide ol li > *:last-child {
      margin-block-end: 0;
    }
    .reveal .slide .columns:nth-child(3) {
      margin-block-start: 0.8em;
    }
    .reveal blockquote {
      box-shadow: none;
    }
    .reveal .tippy-content>* {
      margin-top: 0.2em;
      margin-bottom: 0.7em;
    }
    .reveal .tippy-content>*:last-child {
      margin-bottom: 0.2em;
    }
    .reveal .slide > img.stretch.quarto-figure-center,
    .reveal .slide > img.r-stretch.quarto-figure-center {
      display: block;
      margin-left: auto;
      margin-right: auto; 
    }
    .reveal .slide > img.stretch.quarto-figure-left,
    .reveal .slide > img.r-stretch.quarto-figure-left  {
      display: block;
      margin-left: 0;
      margin-right: auto; 
    }
    .reveal .slide > img.stretch.quarto-figure-right,
    .reveal .slide > img.r-stretch.quarto-figure-right  {
      display: block;
      margin-left: auto;
      margin-right: 0; 
    }
  </style>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" integrity="sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==" crossorigin="anonymous"></script>
  
  <script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>
</head>
<body class="quarto-light">
  <div class="reveal">
    <div class="slides">

<section id="title-slide" data-notes="<p>In this module we will see how we can plot maps with Altair. We will also learn how to colour these maps to link our data to geographical regions.</p>" class="quarto-title-block center">
  <h1 class="title">Visualizing Geographic Data</h1>

<div class="quarto-title-authors">
</div>

</section>
<section id="geographical-file-formats" class="slide level2">
<h2>Geographical file formats</h2>
<div class="sourceCode" id="cb1"><pre class="sourceCode json code-with-copy"><code class="sourceCode json"><span id="cb1-1"><a aria-hidden="true" tabindex="-1"></a><span class="er">//</span> <span class="er">This</span> <span class="er">truncated</span> <span class="er">example</span> <span class="er">does</span> <span class="er">not</span> <span class="er">contain</span> <span class="er">all</span> <span class="er">border</span> <span class="er">coordinates</span> <span class="er">for</span> <span class="er">Colorado</span></span>
<span id="cb1-2"><a aria-hidden="true" tabindex="-1"></a><span class="fu">{</span></span>
<span id="cb1-3"><a aria-hidden="true" tabindex="-1"></a>  <span class="dt">"type"</span><span class="fu">:</span> <span class="st">"Feature"</span><span class="fu">,</span></span>
<span id="cb1-4"><a aria-hidden="true" tabindex="-1"></a>  <span class="dt">"id"</span><span class="fu">:</span> <span class="dv">8</span><span class="fu">,</span></span>
<span id="cb1-5"><a aria-hidden="true" tabindex="-1"></a>  <span class="dt">"properties"</span><span class="fu">:</span> <span class="fu">{</span><span class="dt">"name"</span><span class="fu">:</span> <span class="st">"Colorado"</span><span class="fu">},</span></span>
<span id="cb1-6"><a aria-hidden="true" tabindex="-1"></a>  <span class="dt">"geometry"</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb1-7"><a aria-hidden="true" tabindex="-1"></a>    <span class="dt">"type"</span><span class="fu">:</span> <span class="st">"Polygon"</span><span class="fu">,</span></span>
<span id="cb1-8"><a aria-hidden="true" tabindex="-1"></a>    <span class="dt">"coordinates"</span><span class="fu">:</span> <span class="ot">[</span></span>
<span id="cb1-9"><a aria-hidden="true" tabindex="-1"></a>      <span class="ot">[[</span><span class="fl">-106.32056285448942</span><span class="ot">,</span><span class="fl">40.998675790862656</span><span class="ot">],[</span><span class="fl">-106.19134826714341</span><span class="ot">,</span><span class="fl">40.99813863734313</span><span class="ot">],</span></span>
<span id="cb1-10"><a aria-hidden="true" tabindex="-1"></a>       <span class="ot">[</span><span class="fl">-105.27607827344248</span><span class="ot">,</span><span class="fl">40.99813863734313</span><span class="ot">],[</span><span class="fl">-104.9422739227986</span><span class="ot">,</span><span class="fl">40.99813863734313</span><span class="ot">],</span></span>
<span id="cb1-11"><a aria-hidden="true" tabindex="-1"></a>       <span class="ot">[</span><span class="fl">-104.05212898774828</span><span class="ot">,</span><span class="fl">41.00136155846029</span><span class="ot">],[</span><span class="fl">-103.57475287338661</span><span class="ot">,</span><span class="fl">41.00189871197981</span><span class="ot">],</span></span>
<span id="cb1-12"><a aria-hidden="true" tabindex="-1"></a>       <span class="ot">[</span><span class="fl">-106.32056285448942</span><span class="ot">,</span><span class="fl">40.998675790862656</span><span class="ot">]]</span></span>
<span id="cb1-13"><a aria-hidden="true" tabindex="-1"></a>    <span class="ot">]</span></span>
<span id="cb1-14"><a aria-hidden="true" tabindex="-1"></a>  <span class="fu">}</span></span>
<span id="cb1-15"><a aria-hidden="true" tabindex="-1"></a><span class="fu">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<aside class="notes">
<p>So far, we have sourced all of the data we have visualized using Altair from spreadsheet-like <code>.csv</code> files. We have then worked with the data in Python as tidy data frames.</p>
<p>To easily visualize data on maps we will learn about and use new file formats that are designed specifically for geographic data.</p>
<p>These are called GeoJSON and TopoJSON. Like <code>.csv</code>’s, they and are saved as plain text files, however, they are formatted differently, and they have specific rules for how store geographic data such as positional coordinates, like latitude and longitude.</p>
<p>You can see an example of one here in this slide.</p>
<style type="text/css">
        span.MJX_Assistive_MathML {
          position:absolute!important;
          clip: rect(1px, 1px, 1px, 1px);
          padding: 1px 0 0 0!important;
          border: 0!important;
          height: 1px!important;
          width: 1px!important;
          overflow: hidden!important;
          display:block!important;
      }</style></aside>
</section>
<section id="creating-a-map-in-altair" class="slide level2">
<h2>Creating a map in Altair</h2>
<div id="893e8c46" class="cell" data-execution_count="2">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a aria-hidden="true" tabindex="-1"></a><span class="im">import</span> altair <span class="im">as</span> alt</span>
<span id="cb2-2"><a aria-hidden="true" tabindex="-1"></a><span class="im">from</span> vega_datasets <span class="im">import</span> data</span>
<span id="cb2-3"><a aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-4"><a aria-hidden="true" tabindex="-1"></a>world_map <span class="op">=</span> alt.topo_feature(data.world_110m.url, <span class="st">'countries'</span>)</span>
<span id="cb2-5"><a aria-hidden="true" tabindex="-1"></a>alt.Chart(world_map).mark_geoshape()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="2">

<style>
  #altair-viz-02943fc4d9ed4ec2a620ffc8b0c55dcf.vega-embed {
    width: 100%;
    display: flex;
  }

  #altair-viz-02943fc4d9ed4ec2a620ffc8b0c55dcf.vega-embed details,
  #altair-viz-02943fc4d9ed4ec2a620ffc8b0c55dcf.vega-embed details summary {
    position: relative;
  }
</style>
<div id="altair-viz-02943fc4d9ed4ec2a620ffc8b0c55dcf"></div>
<script type="text/javascript">
  var VEGA_DEBUG = (typeof VEGA_DEBUG == "undefined") ? {} : VEGA_DEBUG;
  (function(spec, embedOpt){
    let outputDiv = document.currentScript.previousElementSibling;
    if (outputDiv.id !== "altair-viz-02943fc4d9ed4ec2a620ffc8b0c55dcf") {
      outputDiv = document.getElementById("altair-viz-02943fc4d9ed4ec2a620ffc8b0c55dcf");
    }

    const paths = {
      "vega": "https://cdn.jsdelivr.net/npm/vega@5?noext",
      "vega-lib": "https://cdn.jsdelivr.net/npm/vega-lib?noext",
      "vega-lite": "https://cdn.jsdelivr.net/npm/vega-lite@5.20.1?noext",
      "vega-embed": "https://cdn.jsdelivr.net/npm/vega-embed@6?noext",
    };

    function maybeLoadScript(lib, version) {
      var key = `${lib.replace("-", "")}_version`;
      return (VEGA_DEBUG[key] == version) ?
        Promise.resolve(paths[lib]) :
        new Promise(function(resolve, reject) {
          var s = document.createElement('script');
          document.getElementsByTagName("head")[0].appendChild(s);
          s.async = true;
          s.onload = () => {
            VEGA_DEBUG[key] = version;
            return resolve(paths[lib]);
          };
          s.onerror = () => reject(`Error loading script: ${paths[lib]}`);
          s.src = paths[lib];
        });
    }

    function showError(err) {
      outputDiv.innerHTML = `<div class="error" style="color:red;">${err}</div>`;
      throw err;
    }

    function displayChart(vegaEmbed) {
      vegaEmbed(outputDiv, spec, embedOpt)
        .catch(err => showError(`Javascript Error: ${err.message}<br>This usually means there's a typo in your chart specification. See the javascript console for the full traceback.`));
    }

    if(typeof define === "function" && define.amd) {
      requirejs.config({paths});
      let deps = ["vega-embed"];
      require(deps, displayChart, err => showError(`Error loading script: ${err.message}`));
    } else {
      maybeLoadScript("vega", "5")
        .then(() => maybeLoadScript("vega-lite", "5.20.1"))
        .then(() => maybeLoadScript("vega-embed", "6"))
        .catch(showError)
        .then(() => displayChart(vegaEmbed));
    }
  })({"config": {"view": {"continuousWidth": 300, "continuousHeight": 300}, "legend": {"titleFontSize": 13, "labelFontSize": 12}, "axis": {"titleFontSize": 13, "labelFontSize": 12}, "header": {"titleFontSize": 15, "labelFontSize": 13}}, "data": {"url": "https://cdn.jsdelivr.net/npm/vega-datasets@v1.29.0/data/world-110m.json", "format": {"feature": "countries", "type": "topojson"}}, "mark": {"type": "geoshape"}, "$schema": "https://vega.github.io/schema/vega-lite/v5.20.1.json"}, {"mode": "vega-lite"});
</script>
</div>
</div>
<aside class="notes">
<p>The vega sample data sets contains data sets we can use to create maps for the world and the US. There are stored in the TopoJSON format. We will now demonstrate how we can use such data with Altair.</p>
<p>To use the TopoJSON data, we need the <code>alt.topo_feature</code> helper function to allow Altair to correctly parse the TopoJSON file. We then use <code>mark_geoshape</code> to visualize this geographic TopoJSON data in the form of a map.</p>
<p>Because, the data contains the border coordinates of each country, we can see these drawn as white lines in the chart on this slide.</p>
<p>Looking at this map however, you might wonder why Antarctica looks so much bigger than the rest of the world?</p>
<style type="text/css">
        span.MJX_Assistive_MathML {
          position:absolute!important;
          clip: rect(1px, 1px, 1px, 1px);
          padding: 1px 0 0 0!important;
          border: 0!important;
          height: 1px!important;
          width: 1px!important;
          overflow: hidden!important;
          display:block!important;
      }</style></aside>
</section>
<section id="changing-the-projection-gives-a-more-accurate-representation-of-areas" class="slide level2">
<h2>Changing the projection gives a more accurate representation of areas</h2>
<div id="117a185c" class="cell" data-execution_count="3">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a aria-hidden="true" tabindex="-1"></a>alt.Chart(world_map).mark_geoshape().project(<span class="bu">type</span><span class="op">=</span><span class="st">'equalEarth'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="3">

<style>
  #altair-viz-3d4db94cc61441e7a849107ee28f909d.vega-embed {
    width: 100%;
    display: flex;
  }

  #altair-viz-3d4db94cc61441e7a849107ee28f909d.vega-embed details,
  #altair-viz-3d4db94cc61441e7a849107ee28f909d.vega-embed details summary {
    position: relative;
  }
</style>
<div id="altair-viz-3d4db94cc61441e7a849107ee28f909d"></div>
<script type="text/javascript">
  var VEGA_DEBUG = (typeof VEGA_DEBUG == "undefined") ? {} : VEGA_DEBUG;
  (function(spec, embedOpt){
    let outputDiv = document.currentScript.previousElementSibling;
    if (outputDiv.id !== "altair-viz-3d4db94cc61441e7a849107ee28f909d") {
      outputDiv = document.getElementById("altair-viz-3d4db94cc61441e7a849107ee28f909d");
    }

    const paths = {
      "vega": "https://cdn.jsdelivr.net/npm/vega@5?noext",
      "vega-lib": "https://cdn.jsdelivr.net/npm/vega-lib?noext",
      "vega-lite": "https://cdn.jsdelivr.net/npm/vega-lite@5.20.1?noext",
      "vega-embed": "https://cdn.jsdelivr.net/npm/vega-embed@6?noext",
    };

    function maybeLoadScript(lib, version) {
      var key = `${lib.replace("-", "")}_version`;
      return (VEGA_DEBUG[key] == version) ?
        Promise.resolve(paths[lib]) :
        new Promise(function(resolve, reject) {
          var s = document.createElement('script');
          document.getElementsByTagName("head")[0].appendChild(s);
          s.async = true;
          s.onload = () => {
            VEGA_DEBUG[key] = version;
            return resolve(paths[lib]);
          };
          s.onerror = () => reject(`Error loading script: ${paths[lib]}`);
          s.src = paths[lib];
        });
    }

    function showError(err) {
      outputDiv.innerHTML = `<div class="error" style="color:red;">${err}</div>`;
      throw err;
    }

    function displayChart(vegaEmbed) {
      vegaEmbed(outputDiv, spec, embedOpt)
        .catch(err => showError(`Javascript Error: ${err.message}<br>This usually means there's a typo in your chart specification. See the javascript console for the full traceback.`));
    }

    if(typeof define === "function" && define.amd) {
      requirejs.config({paths});
      let deps = ["vega-embed"];
      require(deps, displayChart, err => showError(`Error loading script: ${err.message}`));
    } else {
      maybeLoadScript("vega", "5")
        .then(() => maybeLoadScript("vega-lite", "5.20.1"))
        .then(() => maybeLoadScript("vega-embed", "6"))
        .catch(showError)
        .then(() => displayChart(vegaEmbed));
    }
  })({"config": {"view": {"continuousWidth": 300, "continuousHeight": 300}, "legend": {"titleFontSize": 13, "labelFontSize": 12}, "axis": {"titleFontSize": 13, "labelFontSize": 12}, "header": {"titleFontSize": 15, "labelFontSize": 13}}, "data": {"url": "https://cdn.jsdelivr.net/npm/vega-datasets@v1.29.0/data/world-110m.json", "format": {"feature": "countries", "type": "topojson"}}, "mark": {"type": "geoshape"}, "projection": {"type": "equalEarth"}, "$schema": "https://vega.github.io/schema/vega-lite/v5.20.1.json"}, {"mode": "vega-lite"});
</script>
</div>
</div>
<aside class="notes">
<p>Given that the Earth is a sphere it is not entirely straightforward how to represent the areas of the different parts of the world on a two dimensional visualization.</p>
<p>The reason that Antarctica looked so big in the previous slide is because of how the sphere is being stretched when it is projected onto a two dimensional visualization surface.</p>
<p><code>mercator</code> is often used as the default projection method for maps. However, it causes heavy distortion of the relative areas of land masses, and in particular, this distortion gets much worse closer to the poles.</p>
<p>Fortunately, many people are moving away from using this projection because it gives a distorted impression of what the world looks like. A commonly used alternative is the <code>equalEarth</code> projection. This projection focuses on correctly representing the relative areas of all landmasses.</p>
<p>Some of the most noticeable differences in this projection are that Africa appears much bigger and Greenland, Antarctica as well as Russia appear notably smaller.</p>
<p>Africa is in fact 15x the area of Greenland, this is far far from how the <code>mercator</code> projection draws this - it draws them as roughly the same size.</p>
<style type="text/css">
        span.MJX_Assistive_MathML {
          position:absolute!important;
          clip: rect(1px, 1px, 1px, 1px);
          padding: 1px 0 0 0!important;
          border: 0!important;
          height: 1px!important;
          width: 1px!important;
          overflow: hidden!important;
          display:block!important;
      }</style></aside>
</section>
<section id="the-fill-and-border-colours-of-countries-can-be-changed" class="slide level2">
<h2>The fill and border colours of countries can be changed</h2>
<div id="e1e1553a" class="cell" data-execution_count="4">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1"><a aria-hidden="true" tabindex="-1"></a>alt.Chart(world_map).mark_geoshape(</span>
<span id="cb4-2"><a aria-hidden="true" tabindex="-1"></a>    color<span class="op">=</span><span class="st">'black'</span>, stroke<span class="op">=</span><span class="st">'#706545'</span>, strokeWidth<span class="op">=</span><span class="dv">1</span></span>
<span id="cb4-3"><a aria-hidden="true" tabindex="-1"></a>).project(<span class="bu">type</span><span class="op">=</span><span class="st">'equalEarth'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="4">

<style>
  #altair-viz-0c3458bc47d3404aac895166e4128b1c.vega-embed {
    width: 100%;
    display: flex;
  }

  #altair-viz-0c3458bc47d3404aac895166e4128b1c.vega-embed details,
  #altair-viz-0c3458bc47d3404aac895166e4128b1c.vega-embed details summary {
    position: relative;
  }
</style>
<div id="altair-viz-0c3458bc47d3404aac895166e4128b1c"></div>
<script type="text/javascript">
  var VEGA_DEBUG = (typeof VEGA_DEBUG == "undefined") ? {} : VEGA_DEBUG;
  (function(spec, embedOpt){
    let outputDiv = document.currentScript.previousElementSibling;
    if (outputDiv.id !== "altair-viz-0c3458bc47d3404aac895166e4128b1c") {
      outputDiv = document.getElementById("altair-viz-0c3458bc47d3404aac895166e4128b1c");
    }

    const paths = {
      "vega": "https://cdn.jsdelivr.net/npm/vega@5?noext",
      "vega-lib": "https://cdn.jsdelivr.net/npm/vega-lib?noext",
      "vega-lite": "https://cdn.jsdelivr.net/npm/vega-lite@5.20.1?noext",
      "vega-embed": "https://cdn.jsdelivr.net/npm/vega-embed@6?noext",
    };

    function maybeLoadScript(lib, version) {
      var key = `${lib.replace("-", "")}_version`;
      return (VEGA_DEBUG[key] == version) ?
        Promise.resolve(paths[lib]) :
        new Promise(function(resolve, reject) {
          var s = document.createElement('script');
          document.getElementsByTagName("head")[0].appendChild(s);
          s.async = true;
          s.onload = () => {
            VEGA_DEBUG[key] = version;
            return resolve(paths[lib]);
          };
          s.onerror = () => reject(`Error loading script: ${paths[lib]}`);
          s.src = paths[lib];
        });
    }

    function showError(err) {
      outputDiv.innerHTML = `<div class="error" style="color:red;">${err}</div>`;
      throw err;
    }

    function displayChart(vegaEmbed) {
      vegaEmbed(outputDiv, spec, embedOpt)
        .catch(err => showError(`Javascript Error: ${err.message}<br>This usually means there's a typo in your chart specification. See the javascript console for the full traceback.`));
    }

    if(typeof define === "function" && define.amd) {
      requirejs.config({paths});
      let deps = ["vega-embed"];
      require(deps, displayChart, err => showError(`Error loading script: ${err.message}`));
    } else {
      maybeLoadScript("vega", "5")
        .then(() => maybeLoadScript("vega-lite", "5.20.1"))
        .then(() => maybeLoadScript("vega-embed", "6"))
        .catch(showError)
        .then(() => displayChart(vegaEmbed));
    }
  })({"config": {"view": {"continuousWidth": 300, "continuousHeight": 300}, "legend": {"titleFontSize": 13, "labelFontSize": 12}, "axis": {"titleFontSize": 13, "labelFontSize": 12}, "header": {"titleFontSize": 15, "labelFontSize": 13}}, "data": {"url": "https://cdn.jsdelivr.net/npm/vega-datasets@v1.29.0/data/world-110m.json", "format": {"feature": "countries", "type": "topojson"}}, "mark": {"type": "geoshape", "color": "black", "stroke": "#706545", "strokeWidth": 1}, "projection": {"type": "equalEarth"}, "$schema": "https://vega.github.io/schema/vega-lite/v5.20.1.json"}, {"mode": "vega-lite"});
</script>
</div>
</div>
<aside class="notes">
<p>We can change the colour of both the filled maps areas and the geographical borders.</p>
<p>And similar to other colour mappings in Altair, we can use either a named colour or and exact hex-code.</p>
<p>Here we use the named colour black, with the <code>color</code> argument to fill the map areas black, and a hexcode with the <code>stroke</code> argument to change the geographical borders to a grey colour. We also set <code>strokeWidth</code> to 1, so that it is easier to see the country borders.</p>
<style type="text/css">
        span.MJX_Assistive_MathML {
          position:absolute!important;
          clip: rect(1px, 1px, 1px, 1px);
          padding: 1px 0 0 0!important;
          border: 0!important;
          height: 1px!important;
          width: 1px!important;
          overflow: hidden!important;
          display:block!important;
      }</style></aside>
</section>
<section id="we-can-zoom-and-pan-the-map" class="slide level2">
<h2>We can zoom and pan the map</h2>
<div id="51a43e0f" class="cell" data-execution_count="5">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a aria-hidden="true" tabindex="-1"></a>alt.Chart(world_map).mark_geoshape(</span>
<span id="cb5-2"><a aria-hidden="true" tabindex="-1"></a>    color<span class="op">=</span><span class="st">'#2a1d0c'</span>, stroke<span class="op">=</span><span class="st">'#706545'</span>, strokeWidth<span class="op">=</span><span class="fl">0.5</span></span>
<span id="cb5-3"><a aria-hidden="true" tabindex="-1"></a>).project(<span class="bu">type</span><span class="op">=</span><span class="st">'equalEarth'</span>, scale<span class="op">=</span><span class="dv">500</span>, translate<span class="op">=</span>[<span class="dv">140</span>, <span class="dv">610</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="5">

<style>
  #altair-viz-9c096b0c953d4e5e9d097c6d023c15e4.vega-embed {
    width: 100%;
    display: flex;
  }

  #altair-viz-9c096b0c953d4e5e9d097c6d023c15e4.vega-embed details,
  #altair-viz-9c096b0c953d4e5e9d097c6d023c15e4.vega-embed details summary {
    position: relative;
  }
</style>
<div id="altair-viz-9c096b0c953d4e5e9d097c6d023c15e4"></div>
<script type="text/javascript">
  var VEGA_DEBUG = (typeof VEGA_DEBUG == "undefined") ? {} : VEGA_DEBUG;
  (function(spec, embedOpt){
    let outputDiv = document.currentScript.previousElementSibling;
    if (outputDiv.id !== "altair-viz-9c096b0c953d4e5e9d097c6d023c15e4") {
      outputDiv = document.getElementById("altair-viz-9c096b0c953d4e5e9d097c6d023c15e4");
    }

    const paths = {
      "vega": "https://cdn.jsdelivr.net/npm/vega@5?noext",
      "vega-lib": "https://cdn.jsdelivr.net/npm/vega-lib?noext",
      "vega-lite": "https://cdn.jsdelivr.net/npm/vega-lite@5.20.1?noext",
      "vega-embed": "https://cdn.jsdelivr.net/npm/vega-embed@6?noext",
    };

    function maybeLoadScript(lib, version) {
      var key = `${lib.replace("-", "")}_version`;
      return (VEGA_DEBUG[key] == version) ?
        Promise.resolve(paths[lib]) :
        new Promise(function(resolve, reject) {
          var s = document.createElement('script');
          document.getElementsByTagName("head")[0].appendChild(s);
          s.async = true;
          s.onload = () => {
            VEGA_DEBUG[key] = version;
            return resolve(paths[lib]);
          };
          s.onerror = () => reject(`Error loading script: ${paths[lib]}`);
          s.src = paths[lib];
        });
    }

    function showError(err) {
      outputDiv.innerHTML = `<div class="error" style="color:red;">${err}</div>`;
      throw err;
    }

    function displayChart(vegaEmbed) {
      vegaEmbed(outputDiv, spec, embedOpt)
        .catch(err => showError(`Javascript Error: ${err.message}<br>This usually means there's a typo in your chart specification. See the javascript console for the full traceback.`));
    }

    if(typeof define === "function" && define.amd) {
      requirejs.config({paths});
      let deps = ["vega-embed"];
      require(deps, displayChart, err => showError(`Error loading script: ${err.message}`));
    } else {
      maybeLoadScript("vega", "5")
        .then(() => maybeLoadScript("vega-lite", "5.20.1"))
        .then(() => maybeLoadScript("vega-embed", "6"))
        .catch(showError)
        .then(() => displayChart(vegaEmbed));
    }
  })({"config": {"view": {"continuousWidth": 300, "continuousHeight": 300}, "legend": {"titleFontSize": 13, "labelFontSize": 12}, "axis": {"titleFontSize": 13, "labelFontSize": 12}, "header": {"titleFontSize": 15, "labelFontSize": 13}}, "data": {"url": "https://cdn.jsdelivr.net/npm/vega-datasets@v1.29.0/data/world-110m.json", "format": {"feature": "countries", "type": "topojson"}}, "mark": {"type": "geoshape", "color": "#2a1d0c", "stroke": "#706545", "strokeWidth": 0.5}, "projection": {"scale": 500, "translate": [140, 610], "type": "equalEarth"}, "$schema": "https://vega.github.io/schema/vega-lite/v5.20.1.json"}, {"mode": "vega-lite"});
</script>
</div>
</div>
<aside class="notes">
<p>By default Altair automatically adjusts the projection so that all the data fits within the width and height of the chart.</p>
<p>We can change this by setting custom values for the projections parameters <code>scale</code>, which sets the zoom level, and <code>translate</code>, which sets where to pan to.</p>
<p>Here we adjust these so that we can zoom in and centre the map on Europe.</p>
<p>Have patience with yourself and Altair while doing this, as getting the panning and zooming just right can take a bit of fiddling.</p>
<style type="text/css">
        span.MJX_Assistive_MathML {
          position:absolute!important;
          clip: rect(1px, 1px, 1px, 1px);
          padding: 1px 0 0 0!important;
          border: 0!important;
          height: 1px!important;
          width: 1px!important;
          overflow: hidden!important;
          display:block!important;
      }</style></aside>
</section>
<section id="working-with-individual-countries-can-show-regional-details" class="slide level2">
<h2>Working with individual countries can show regional details</h2>
<div id="ec020dee" class="cell" data-execution_count="6">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb6-1"><a aria-hidden="true" tabindex="-1"></a>state_map <span class="op">=</span> alt.topo_feature(data.us_10m.url, <span class="st">'states'</span>)</span>
<span id="cb6-2"><a aria-hidden="true" tabindex="-1"></a>alt.Chart(state_map).mark_geoshape().project(<span class="bu">type</span><span class="op">=</span><span class="st">'equalEarth'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="6">

<style>
  #altair-viz-400cd0b36543433491e9f97e54f33937.vega-embed {
    width: 100%;
    display: flex;
  }

  #altair-viz-400cd0b36543433491e9f97e54f33937.vega-embed details,
  #altair-viz-400cd0b36543433491e9f97e54f33937.vega-embed details summary {
    position: relative;
  }
</style>
<div id="altair-viz-400cd0b36543433491e9f97e54f33937"></div>
<script type="text/javascript">
  var VEGA_DEBUG = (typeof VEGA_DEBUG == "undefined") ? {} : VEGA_DEBUG;
  (function(spec, embedOpt){
    let outputDiv = document.currentScript.previousElementSibling;
    if (outputDiv.id !== "altair-viz-400cd0b36543433491e9f97e54f33937") {
      outputDiv = document.getElementById("altair-viz-400cd0b36543433491e9f97e54f33937");
    }

    const paths = {
      "vega": "https://cdn.jsdelivr.net/npm/vega@5?noext",
      "vega-lib": "https://cdn.jsdelivr.net/npm/vega-lib?noext",
      "vega-lite": "https://cdn.jsdelivr.net/npm/vega-lite@5.20.1?noext",
      "vega-embed": "https://cdn.jsdelivr.net/npm/vega-embed@6?noext",
    };

    function maybeLoadScript(lib, version) {
      var key = `${lib.replace("-", "")}_version`;
      return (VEGA_DEBUG[key] == version) ?
        Promise.resolve(paths[lib]) :
        new Promise(function(resolve, reject) {
          var s = document.createElement('script');
          document.getElementsByTagName("head")[0].appendChild(s);
          s.async = true;
          s.onload = () => {
            VEGA_DEBUG[key] = version;
            return resolve(paths[lib]);
          };
          s.onerror = () => reject(`Error loading script: ${paths[lib]}`);
          s.src = paths[lib];
        });
    }

    function showError(err) {
      outputDiv.innerHTML = `<div class="error" style="color:red;">${err}</div>`;
      throw err;
    }

    function displayChart(vegaEmbed) {
      vegaEmbed(outputDiv, spec, embedOpt)
        .catch(err => showError(`Javascript Error: ${err.message}<br>This usually means there's a typo in your chart specification. See the javascript console for the full traceback.`));
    }

    if(typeof define === "function" && define.amd) {
      requirejs.config({paths});
      let deps = ["vega-embed"];
      require(deps, displayChart, err => showError(`Error loading script: ${err.message}`));
    } else {
      maybeLoadScript("vega", "5")
        .then(() => maybeLoadScript("vega-lite", "5.20.1"))
        .then(() => maybeLoadScript("vega-embed", "6"))
        .catch(showError)
        .then(() => displayChart(vegaEmbed));
    }
  })({"config": {"view": {"continuousWidth": 300, "continuousHeight": 300}, "legend": {"titleFontSize": 13, "labelFontSize": 12}, "axis": {"titleFontSize": 13, "labelFontSize": 12}, "header": {"titleFontSize": 15, "labelFontSize": 13}}, "data": {"url": "https://cdn.jsdelivr.net/npm/vega-datasets@v1.29.0/data/us-10m.json", "format": {"feature": "states", "type": "topojson"}}, "mark": {"type": "geoshape"}, "projection": {"type": "equalEarth"}, "$schema": "https://vega.github.io/schema/vega-lite/v5.20.1.json"}, {"mode": "vega-lite"});
</script>
</div>
</div>
<aside class="notes">
<p>If we want information on regions within a country, we have to use a geoJSON or topoJSON file that contains this information. The vega demo datasets has such a file for the United States, so we use that to demonstrate how to do this here.</p>
<p>We load the data in the same way as before, however, you can see that the <code>equalEarth</code> projection doesn’t seem to work well here.</p>
<p>Using it leads to the country being quite small, and not centred. Furthermore, it leads to both Alaska and Hawaii being spaced quite far from the rest of the country.</p>
<style type="text/css">
        span.MJX_Assistive_MathML {
          position:absolute!important;
          clip: rect(1px, 1px, 1px, 1px);
          padding: 1px 0 0 0!important;
          border: 0!important;
          height: 1px!important;
          width: 1px!important;
          overflow: hidden!important;
          display:block!important;
      }</style></aside>
</section>
<section id="there-are-special-projections-for-some-countries-such-as-the-us" class="slide level2">
<h2>There are special projections for some countries such as the US</h2>
<div id="35915d24" class="cell" data-execution_count="7">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb7-1"><a aria-hidden="true" tabindex="-1"></a>alt.Chart(state_map).mark_geoshape().project(<span class="bu">type</span><span class="op">=</span><span class="st">'albersUsa'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="7">

<style>
  #altair-viz-1ffb89a2a2f349569d4d5b564d144d2e.vega-embed {
    width: 100%;
    display: flex;
  }

  #altair-viz-1ffb89a2a2f349569d4d5b564d144d2e.vega-embed details,
  #altair-viz-1ffb89a2a2f349569d4d5b564d144d2e.vega-embed details summary {
    position: relative;
  }
</style>
<div id="altair-viz-1ffb89a2a2f349569d4d5b564d144d2e"></div>
<script type="text/javascript">
  var VEGA_DEBUG = (typeof VEGA_DEBUG == "undefined") ? {} : VEGA_DEBUG;
  (function(spec, embedOpt){
    let outputDiv = document.currentScript.previousElementSibling;
    if (outputDiv.id !== "altair-viz-1ffb89a2a2f349569d4d5b564d144d2e") {
      outputDiv = document.getElementById("altair-viz-1ffb89a2a2f349569d4d5b564d144d2e");
    }

    const paths = {
      "vega": "https://cdn.jsdelivr.net/npm/vega@5?noext",
      "vega-lib": "https://cdn.jsdelivr.net/npm/vega-lib?noext",
      "vega-lite": "https://cdn.jsdelivr.net/npm/vega-lite@5.20.1?noext",
      "vega-embed": "https://cdn.jsdelivr.net/npm/vega-embed@6?noext",
    };

    function maybeLoadScript(lib, version) {
      var key = `${lib.replace("-", "")}_version`;
      return (VEGA_DEBUG[key] == version) ?
        Promise.resolve(paths[lib]) :
        new Promise(function(resolve, reject) {
          var s = document.createElement('script');
          document.getElementsByTagName("head")[0].appendChild(s);
          s.async = true;
          s.onload = () => {
            VEGA_DEBUG[key] = version;
            return resolve(paths[lib]);
          };
          s.onerror = () => reject(`Error loading script: ${paths[lib]}`);
          s.src = paths[lib];
        });
    }

    function showError(err) {
      outputDiv.innerHTML = `<div class="error" style="color:red;">${err}</div>`;
      throw err;
    }

    function displayChart(vegaEmbed) {
      vegaEmbed(outputDiv, spec, embedOpt)
        .catch(err => showError(`Javascript Error: ${err.message}<br>This usually means there's a typo in your chart specification. See the javascript console for the full traceback.`));
    }

    if(typeof define === "function" && define.amd) {
      requirejs.config({paths});
      let deps = ["vega-embed"];
      require(deps, displayChart, err => showError(`Error loading script: ${err.message}`));
    } else {
      maybeLoadScript("vega", "5")
        .then(() => maybeLoadScript("vega-lite", "5.20.1"))
        .then(() => maybeLoadScript("vega-embed", "6"))
        .catch(showError)
        .then(() => displayChart(vegaEmbed));
    }
  })({"config": {"view": {"continuousWidth": 300, "continuousHeight": 300}, "legend": {"titleFontSize": 13, "labelFontSize": 12}, "axis": {"titleFontSize": 13, "labelFontSize": 12}, "header": {"titleFontSize": 15, "labelFontSize": 13}}, "data": {"url": "https://cdn.jsdelivr.net/npm/vega-datasets@v1.29.0/data/us-10m.json", "format": {"feature": "states", "type": "topojson"}}, "mark": {"type": "geoshape"}, "projection": {"type": "albersUsa"}, "$schema": "https://vega.github.io/schema/vega-lite/v5.20.1.json"}, {"mode": "vega-lite"});
</script>
</div>
</div>
<aside class="notes">
<p>To fix this, we can use a special projection <code>albersUsa</code> that was created to visualize maps of the United States. It is a much preferred projection when only showing this country.</p>
<p>You might recognize the projection from maps that you have seen outside of this course, such as on the news. Of note, is the characteristic placement of Alaska and Hawaii close to the rest of the country.</p>
<style type="text/css">
        span.MJX_Assistive_MathML {
          position:absolute!important;
          clip: rect(1px, 1px, 1px, 1px);
          padding: 1px 0 0 0!important;
          border: 0!important;
          height: 1px!important;
          width: 1px!important;
          overflow: hidden!important;
          display:block!important;
      }</style></aside>
</section>
<section id="colouring-individual-regions-differently" class="slide level2">
<h2>Colouring individual regions differently</h2>
<div id="f2aed148" class="cell" data-execution_count="8">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb8-1"><a aria-hidden="true" tabindex="-1"></a>(alt.Chart(state_map).mark_geoshape().encode(</span>
<span id="cb8-2"><a aria-hidden="true" tabindex="-1"></a>    color<span class="op">=</span><span class="st">'id:Q'</span>)</span>
<span id="cb8-3"><a aria-hidden="true" tabindex="-1"></a>.project(<span class="bu">type</span><span class="op">=</span><span class="st">'albersUsa'</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="8">

<style>
  #altair-viz-41aad24c287d4171acb3156e5fecb52e.vega-embed {
    width: 100%;
    display: flex;
  }

  #altair-viz-41aad24c287d4171acb3156e5fecb52e.vega-embed details,
  #altair-viz-41aad24c287d4171acb3156e5fecb52e.vega-embed details summary {
    position: relative;
  }
</style>
<div id="altair-viz-41aad24c287d4171acb3156e5fecb52e"></div>
<script type="text/javascript">
  var VEGA_DEBUG = (typeof VEGA_DEBUG == "undefined") ? {} : VEGA_DEBUG;
  (function(spec, embedOpt){
    let outputDiv = document.currentScript.previousElementSibling;
    if (outputDiv.id !== "altair-viz-41aad24c287d4171acb3156e5fecb52e") {
      outputDiv = document.getElementById("altair-viz-41aad24c287d4171acb3156e5fecb52e");
    }

    const paths = {
      "vega": "https://cdn.jsdelivr.net/npm/vega@5?noext",
      "vega-lib": "https://cdn.jsdelivr.net/npm/vega-lib?noext",
      "vega-lite": "https://cdn.jsdelivr.net/npm/vega-lite@5.20.1?noext",
      "vega-embed": "https://cdn.jsdelivr.net/npm/vega-embed@6?noext",
    };

    function maybeLoadScript(lib, version) {
      var key = `${lib.replace("-", "")}_version`;
      return (VEGA_DEBUG[key] == version) ?
        Promise.resolve(paths[lib]) :
        new Promise(function(resolve, reject) {
          var s = document.createElement('script');
          document.getElementsByTagName("head")[0].appendChild(s);
          s.async = true;
          s.onload = () => {
            VEGA_DEBUG[key] = version;
            return resolve(paths[lib]);
          };
          s.onerror = () => reject(`Error loading script: ${paths[lib]}`);
          s.src = paths[lib];
        });
    }

    function showError(err) {
      outputDiv.innerHTML = `<div class="error" style="color:red;">${err}</div>`;
      throw err;
    }

    function displayChart(vegaEmbed) {
      vegaEmbed(outputDiv, spec, embedOpt)
        .catch(err => showError(`Javascript Error: ${err.message}<br>This usually means there's a typo in your chart specification. See the javascript console for the full traceback.`));
    }

    if(typeof define === "function" && define.amd) {
      requirejs.config({paths});
      let deps = ["vega-embed"];
      require(deps, displayChart, err => showError(`Error loading script: ${err.message}`));
    } else {
      maybeLoadScript("vega", "5")
        .then(() => maybeLoadScript("vega-lite", "5.20.1"))
        .then(() => maybeLoadScript("vega-embed", "6"))
        .catch(showError)
        .then(() => displayChart(vegaEmbed));
    }
  })({"config": {"view": {"continuousWidth": 300, "continuousHeight": 300}, "legend": {"titleFontSize": 13, "labelFontSize": 12}, "axis": {"titleFontSize": 13, "labelFontSize": 12}, "header": {"titleFontSize": 15, "labelFontSize": 13}}, "data": {"url": "https://cdn.jsdelivr.net/npm/vega-datasets@v1.29.0/data/us-10m.json", "format": {"feature": "states", "type": "topojson"}}, "mark": {"type": "geoshape"}, "encoding": {"color": {"field": "id", "type": "quantitative"}}, "projection": {"type": "albersUsa"}, "$schema": "https://vega.github.io/schema/vega-lite/v5.20.1.json"}, {"mode": "vega-lite"});
</script>
</div>
</div>
<aside class="notes">
<p>So far we have seen how to visualize regions with a uniform colour, but often we want to use colour to map values or summary statistics from our data to different geographic regions. How can we do this in Altair?</p>
<p>As you can see in this slide, we can use <code>encode</code> together with <code>mark_geojson</code>, the same way we have used it with the other marks. This type of visualization can be thought of as a geographical heatmap and is often referred to as a “choropleth map”.</p>
<p>To introduce how we can do this - we will map the states identification number from our topoJSON file we loaded, to the corresponding geographic region for each state. Normally, we would not do this, but instead map some other data to each geographic region. We will do that in the following slides.</p>
<p>The <code>'id'</code> field here comes from the sample topoJSON file. If we opened up and looked at this file, we would find that it contains a field called <code>'id'</code>, which is a numerical identifier for each state in alphabetical order.</p>
<p>Because we are not using a pandas dataframe, we mush specify the type of data in the column. Here we are specifying it as a quantitative for demonstration purposes because the legend would become very long if we specified it as ordinal or nominal.</p>
<style type="text/css">
        span.MJX_Assistive_MathML {
          position:absolute!important;
          clip: rect(1px, 1px, 1px, 1px);
          padding: 1px 0 0 0!important;
          border: 0!important;
          height: 1px!important;
          width: 1px!important;
          overflow: hidden!important;
          display:block!important;
      }</style></aside>
</section>
<section id="visualizing-data-from-another-dataframe-on-a-map" class="slide level2">
<h2>Visualizing data from another dataframe on a map</h2>
<div id="05352b15" class="cell" data-execution_count="9">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb9-1"><a aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb9-2"><a aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-3"><a aria-hidden="true" tabindex="-1"></a>state_pop <span class="op">=</span> pd.read_csv(<span class="st">"../../data/us_population_coordinates_asthma-cases.csv"</span>)</span>
<span id="cb9-4"><a aria-hidden="true" tabindex="-1"></a>state_pop[:<span class="dv">5</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="9">
<div>
<style scoped="">
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>

<table class="dataframe caption-top" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header" style="text-align: right;">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">state</th>
<th data-quarto-table-cell-role="th">id</th>
<th data-quarto-table-cell-role="th">population</th>
<th data-quarto-table-cell-role="th">latitude</th>
<th data-quarto-table-cell-role="th">longitude</th>
<th data-quarto-table-cell-role="th">number_of_asthma_cases</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>Alabama</td>
<td>1</td>
<td>4863300</td>
<td>32.7794</td>
<td>-86.8287</td>
<td>394634</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>Alaska</td>
<td>2</td>
<td>741894</td>
<td>64.0685</td>
<td>-152.2782</td>
<td>50685</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>Arizona</td>
<td>4</td>
<td>6931071</td>
<td>34.2744</td>
<td>-111.6602</td>
<td>545104</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>Arkansas</td>
<td>5</td>
<td>2988248</td>
<td>34.8938</td>
<td>-92.4426</td>
<td>225853</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>California</td>
<td>6</td>
<td>39250017</td>
<td>37.1841</td>
<td>-119.4696</td>
<td>2607598</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<aside class="notes">
<p>So far we have learned how to visualize maps, but we haven’t really been able to ask and answer any interesting questions.</p>
<p>Although any arbitrary information could be put in a topoJSON, or geoJSON file, they often only contain spatial coordinates. Thus, we often need to link our variables of interest from another data set with the data in the topoJSON, or geoJSON file.</p>
<p>For example, we might have a table like this, with the population for each state and wish to visualize it on a map? So how do we link these two tables together?</p>
<style type="text/css">
        span.MJX_Assistive_MathML {
          position:absolute!important;
          clip: rect(1px, 1px, 1px, 1px);
          padding: 1px 0 0 0!important;
          border: 0!important;
          height: 1px!important;
          width: 1px!important;
          overflow: hidden!important;
          display:block!important;
      }</style></aside>
</section>
<section id="linking-datasets-together-via-lookups" class="slide level2">
<h2>Linking datasets together via lookups</h2>
<div id="24a26c4a" class="cell" data-execution_count="10">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb10-1"><a aria-hidden="true" tabindex="-1"></a>(alt.Chart(state_map).mark_geoshape().transform_lookup(</span>
<span id="cb10-2"><a aria-hidden="true" tabindex="-1"></a>    lookup<span class="op">=</span><span class="st">'id'</span>,</span>
<span id="cb10-3"><a aria-hidden="true" tabindex="-1"></a>    from_<span class="op">=</span>alt.LookupData(state_pop, <span class="st">'id'</span>, [<span class="st">'population'</span>]))</span>
<span id="cb10-4"><a aria-hidden="true" tabindex="-1"></a>.encode(color<span class="op">=</span><span class="st">'population:Q'</span>)</span>
<span id="cb10-5"><a aria-hidden="true" tabindex="-1"></a>.project(<span class="bu">type</span><span class="op">=</span><span class="st">'albersUsa'</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="10">

<style>
  #altair-viz-5ff3e4795bb94c0ea995e0f52a456d05.vega-embed {
    width: 100%;
    display: flex;
  }

  #altair-viz-5ff3e4795bb94c0ea995e0f52a456d05.vega-embed details,
  #altair-viz-5ff3e4795bb94c0ea995e0f52a456d05.vega-embed details summary {
    position: relative;
  }
</style>
<div id="altair-viz-5ff3e4795bb94c0ea995e0f52a456d05"></div>
<script type="text/javascript">
  var VEGA_DEBUG = (typeof VEGA_DEBUG == "undefined") ? {} : VEGA_DEBUG;
  (function(spec, embedOpt){
    let outputDiv = document.currentScript.previousElementSibling;
    if (outputDiv.id !== "altair-viz-5ff3e4795bb94c0ea995e0f52a456d05") {
      outputDiv = document.getElementById("altair-viz-5ff3e4795bb94c0ea995e0f52a456d05");
    }

    const paths = {
      "vega": "https://cdn.jsdelivr.net/npm/vega@5?noext",
      "vega-lib": "https://cdn.jsdelivr.net/npm/vega-lib?noext",
      "vega-lite": "https://cdn.jsdelivr.net/npm/vega-lite@5.20.1?noext",
      "vega-embed": "https://cdn.jsdelivr.net/npm/vega-embed@6?noext",
    };

    function maybeLoadScript(lib, version) {
      var key = `${lib.replace("-", "")}_version`;
      return (VEGA_DEBUG[key] == version) ?
        Promise.resolve(paths[lib]) :
        new Promise(function(resolve, reject) {
          var s = document.createElement('script');
          document.getElementsByTagName("head")[0].appendChild(s);
          s.async = true;
          s.onload = () => {
            VEGA_DEBUG[key] = version;
            return resolve(paths[lib]);
          };
          s.onerror = () => reject(`Error loading script: ${paths[lib]}`);
          s.src = paths[lib];
        });
    }

    function showError(err) {
      outputDiv.innerHTML = `<div class="error" style="color:red;">${err}</div>`;
      throw err;
    }

    function displayChart(vegaEmbed) {
      vegaEmbed(outputDiv, spec, embedOpt)
        .catch(err => showError(`Javascript Error: ${err.message}<br>This usually means there's a typo in your chart specification. See the javascript console for the full traceback.`));
    }

    if(typeof define === "function" && define.amd) {
      requirejs.config({paths});
      let deps = ["vega-embed"];
      require(deps, displayChart, err => showError(`Error loading script: ${err.message}`));
    } else {
      maybeLoadScript("vega", "5")
        .then(() => maybeLoadScript("vega-lite", "5.20.1"))
        .then(() => maybeLoadScript("vega-embed", "6"))
        .catch(showError)
        .then(() => displayChart(vegaEmbed));
    }
  })({"config": {"view": {"continuousWidth": 300, "continuousHeight": 300}, "legend": {"titleFontSize": 13, "labelFontSize": 12}, "axis": {"titleFontSize": 13, "labelFontSize": 12}, "header": {"titleFontSize": 15, "labelFontSize": 13}}, "data": {"url": "https://cdn.jsdelivr.net/npm/vega-datasets@v1.29.0/data/us-10m.json", "format": {"feature": "states", "type": "topojson"}}, "mark": {"type": "geoshape"}, "encoding": {"color": {"field": "population", "type": "quantitative"}}, "projection": {"type": "albersUsa"}, "transform": [{"lookup": "id", "from": {"data": {"name": "data-4c2b4418d2e44508bf79a511cd28630d"}, "key": "id", "fields": ["population"]}}], "$schema": "https://vega.github.io/schema/vega-lite/v5.20.1.json", "datasets": {"data-4c2b4418d2e44508bf79a511cd28630d": [{"state": "Alabama", "id": 1, "population": 4863300, "latitude": 32.7794, "longitude": -86.8287, "number_of_asthma_cases": 394634}, {"state": "Alaska", "id": 2, "population": 741894, "latitude": 64.0685, "longitude": -152.2782, "number_of_asthma_cases": 50685}, {"state": "Arizona", "id": 4, "population": 6931071, "latitude": 34.2744, "longitude": -111.6602, "number_of_asthma_cases": 545104}, {"state": "Arkansas", "id": 5, "population": 2988248, "latitude": 34.8938, "longitude": -92.4426, "number_of_asthma_cases": 225853}, {"state": "California", "id": 6, "population": 39250017, "latitude": 37.1841, "longitude": -119.4696, "number_of_asthma_cases": 2607598}, {"state": "Colorado", "id": 8, "population": 5540545, "latitude": 38.9972, "longitude": -105.5478, "number_of_asthma_cases": 399357}, {"state": "Connecticut", "id": 9, "population": 3576452, "latitude": 41.6219, "longitude": -72.7273, "number_of_asthma_cases": 290278}, {"state": "Delaware", "id": 10, "population": 952065, "latitude": 38.9896, "longitude": -75.505, "number_of_asthma_cases": 77035}, {"state": "District of Columbia", "id": 11, "population": 681170, "latitude": 38.9101, "longitude": -77.0147, "number_of_asthma_cases": 66441}, {"state": "Florida", "id": 12, "population": 20612439, "latitude": 28.6305, "longitude": -82.4497, "number_of_asthma_cases": 1495632}, {"state": "Georgia", "id": 13, "population": 10310371, "latitude": 32.6415, "longitude": -83.4426, "number_of_asthma_cases": 714569}, {"state": "Hawaii", "id": 15, "population": 1428557, "latitude": 20.2927, "longitude": -156.3737, "number_of_asthma_cases": 104368}, {"state": "Idaho", "id": 16, "population": 1683140, "latitude": 44.3509, "longitude": -114.613, "number_of_asthma_cases": 111954}, {"state": "Illinois", "id": 17, "population": 12801539, "latitude": 40.0417, "longitude": -89.1965, "number_of_asthma_cases": 860007}, {"state": "Indiana", "id": 18, "population": 6633053, "latitude": 39.8942, "longitude": -86.2816, "number_of_asthma_cases": 509651}, {"state": "Iowa", "id": 19, "population": 3134693, "latitude": 42.0751, "longitude": -93.496, "number_of_asthma_cases": 190960}, {"state": "Kansas", "id": 20, "population": 2907289, "latitude": 38.4937, "longitude": -98.3804, "number_of_asthma_cases": 214698}, {"state": "Kentucky", "id": 21, "population": 4436974, "latitude": 37.5347, "longitude": -85.3021, "number_of_asthma_cases": 395345}, {"state": "Louisiana", "id": 22, "population": 4681666, "latitude": 31.0689, "longitude": -91.9968, "number_of_asthma_cases": 316423}, {"state": "Maine", "id": 23, "population": 1331479, "latitude": 45.3695, "longitude": -69.2428, "number_of_asthma_cases": 132126}, {"state": "Maryland", "id": 24, "population": 6016447, "latitude": 39.055, "longitude": -76.7909, "number_of_asthma_cases": 439909}, {"state": "Massachusetts", "id": 25, "population": 6811779, "latitude": 42.2596, "longitude": -71.8083, "number_of_asthma_cases": 558435}, {"state": "Michigan", "id": 26, "population": 9928300, "latitude": 44.3467, "longitude": -85.4102, "number_of_asthma_cases": 872519}, {"state": "Minnesota", "id": 27, "population": 5519952, "latitude": 46.2807, "longitude": -94.3053, "number_of_asthma_cases": 357232}, {"state": "Mississippi", "id": 28, "population": 2988726, "latitude": 32.7364, "longitude": -89.6678, "number_of_asthma_cases": 218223}, {"state": "Missouri", "id": 29, "population": 6093000, "latitude": 38.3566, "longitude": -92.458, "number_of_asthma_cases": 444334}, {"state": "Montana", "id": 30, "population": 1042520, "latitude": 47.0527, "longitude": -109.6333, "number_of_asthma_cases": 82660}, {"state": "Nebraska", "id": 31, "population": 1907116, "latitude": 41.5378, "longitude": -99.7951, "number_of_asthma_cases": 128793}, {"state": "Nevada", "id": 32, "population": 2940058, "latitude": 39.3289, "longitude": -116.6312, "number_of_asthma_cases": 186787}, {"state": "New Hampshire", "id": 33, "population": 1334795, "latitude": 43.6805, "longitude": -71.5811, "number_of_asthma_cases": 128307}, {"state": "New Jersey", "id": 34, "population": 8944469, "latitude": 40.1907, "longitude": -74.6728, "number_of_asthma_cases": 593242}, {"state": "New Mexico", "id": 35, "population": 2081015, "latitude": 34.4071, "longitude": -106.1126, "number_of_asthma_cases": 157177}, {"state": "New York", "id": 36, "population": 19745289, "latitude": 42.9538, "longitude": -75.5268, "number_of_asthma_cases": 1578011}, {"state": "North Carolina", "id": 37, "population": 10146788, "latitude": 35.5557, "longitude": -79.3877, "number_of_asthma_cases": 757790}, {"state": "North Dakota", "id": 38, "population": 757952, "latitude": 47.4501, "longitude": -100.4659, "number_of_asthma_cases": 46996}, {"state": "Ohio", "id": 39, "population": 11614373, "latitude": 40.2862, "longitude": -82.7937, "number_of_asthma_cases": 854186}, {"state": "Oklahoma", "id": 40, "population": 3923561, "latitude": 35.5889, "longitude": -97.4943, "number_of_asthma_cases": 307581}, {"state": "Oregon", "id": 41, "population": 4093465, "latitude": 43.9336, "longitude": -120.5583, "number_of_asthma_cases": 383340}, {"state": "Pennsylvania", "id": 42, "population": 12784227, "latitude": 40.8781, "longitude": -77.7996, "number_of_asthma_cases": 1012588}, {"state": "Rhode Island", "id": 44, "population": 1056426, "latitude": 41.6762, "longitude": -71.5562, "number_of_asthma_cases": 101251}, {"state": "South Carolina", "id": 45, "population": 4961119, "latitude": 33.9169, "longitude": -80.8964, "number_of_asthma_cases": 360353}, {"state": "South Dakota", "id": 46, "population": 865454, "latitude": 44.4443, "longitude": -100.2263, "number_of_asthma_cases": 51652}, {"state": "Tennessee", "id": 47, "population": 6651194, "latitude": 35.85800000000001, "longitude": -86.3505, "number_of_asthma_cases": 513084}, {"state": "Texas", "id": 48, "population": 27862596, "latitude": 31.4757, "longitude": -99.3312, "number_of_asthma_cases": 1572815}, {"state": "Utah", "id": 49, "population": 3051217, "latitude": 39.3055, "longitude": -111.6703, "number_of_asthma_cases": 206360}, {"state": "Vermont", "id": 50, "population": 624594, "latitude": 44.0687, "longitude": -72.6658, "number_of_asthma_cases": 60216}, {"state": "Virginia", "id": 51, "population": 8411808, "latitude": 37.5215, "longitude": -78.8537, "number_of_asthma_cases": 563510}, {"state": "Washington", "id": 53, "population": 7288000, "latitude": 47.3826, "longitude": -120.4472, "number_of_asthma_cases": 558951}, {"state": "West Virginia", "id": 54, "population": 1831102, "latitude": 38.6409, "longitude": -80.6227, "number_of_asthma_cases": 175368}, {"state": "Wisconsin", "id": 55, "population": 5778708, "latitude": 44.6243, "longitude": -89.9941, "number_of_asthma_cases": 408318}, {"state": "Wyoming", "id": 56, "population": 585501, "latitude": 42.9957, "longitude": -107.5512, "number_of_asthma_cases": 38099}]}}, {"mode": "vega-lite"});
</script>
</div>
</div>
<aside class="notes">
<p>We could perform the linkage manually, by adding the relevant fields to the json file, but this would be a tedious and error-prone process.</p>
<p>There are some libraries, such as geopandas which can ameliorate this situation, but we could also use Altair directly to save time.</p>
<p>To link two datasets together, Altair uses the <code>transform_lookup</code> method to <em>look up</em> the data column we want to use from the dataframe via a shared key column. And then adds it to the plotted data. This process is similar to using <code>merge</code> in pandas.</p>
<p>You could see in the previous slide that there exists an ID column and this contains the state IDs in alphabetical order, just like the topoJSON file - and so we can use that for the lookup.</p>
<p>The columns we want to fetch from the data frame are passed in a list, and here we have specified only the population, We will use that to colour the states accordingly to how many people live in each state.</p>
<style type="text/css">
        span.MJX_Assistive_MathML {
          position:absolute!important;
          clip: rect(1px, 1px, 1px, 1px);
          padding: 1px 0 0 0!important;
          border: 0!important;
          height: 1px!important;
          width: 1px!important;
          overflow: hidden!important;
          display:block!important;
      }</style></aside>
</section>
<section id="choropleths-can-be-misleading-since-the-area-of-each-region-matters" class="slide level2">
<h2>Choropleths can be misleading since the area of each region matters</h2>
<div id="37b54d46" class="cell" data-execution_count="11">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb11-1"><a aria-hidden="true" tabindex="-1"></a>us_map <span class="op">=</span> (alt.Chart(state_map).mark_geoshape(color<span class="op">=</span><span class="st">'lightgray'</span>, stroke<span class="op">=</span><span class="st">'white'</span>)</span>
<span id="cb11-2"><a aria-hidden="true" tabindex="-1"></a>          .project(<span class="bu">type</span><span class="op">=</span><span class="st">'albersUsa'</span>))</span>
<span id="cb11-3"><a aria-hidden="true" tabindex="-1"></a>points <span class="op">=</span> alt.Chart(state_pop).mark_circle().encode(</span>
<span id="cb11-4"><a aria-hidden="true" tabindex="-1"></a>    longitude<span class="op">=</span><span class="st">'longitude'</span>,</span>
<span id="cb11-5"><a aria-hidden="true" tabindex="-1"></a>    latitude<span class="op">=</span><span class="st">'latitude'</span>,</span>
<span id="cb11-6"><a aria-hidden="true" tabindex="-1"></a>    size<span class="op">=</span><span class="st">'population'</span>)</span>
<span id="cb11-7"><a aria-hidden="true" tabindex="-1"></a>(us_map <span class="op">+</span> points).configure_view(stroke<span class="op">=</span><span class="va">None</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="11">

<style>
  #altair-viz-399b0f7c76e646739bfc46d3e822ff24.vega-embed {
    width: 100%;
    display: flex;
  }

  #altair-viz-399b0f7c76e646739bfc46d3e822ff24.vega-embed details,
  #altair-viz-399b0f7c76e646739bfc46d3e822ff24.vega-embed details summary {
    position: relative;
  }
</style>
<div id="altair-viz-399b0f7c76e646739bfc46d3e822ff24"></div>
<script type="text/javascript">
  var VEGA_DEBUG = (typeof VEGA_DEBUG == "undefined") ? {} : VEGA_DEBUG;
  (function(spec, embedOpt){
    let outputDiv = document.currentScript.previousElementSibling;
    if (outputDiv.id !== "altair-viz-399b0f7c76e646739bfc46d3e822ff24") {
      outputDiv = document.getElementById("altair-viz-399b0f7c76e646739bfc46d3e822ff24");
    }

    const paths = {
      "vega": "https://cdn.jsdelivr.net/npm/vega@5?noext",
      "vega-lib": "https://cdn.jsdelivr.net/npm/vega-lib?noext",
      "vega-lite": "https://cdn.jsdelivr.net/npm/vega-lite@5.20.1?noext",
      "vega-embed": "https://cdn.jsdelivr.net/npm/vega-embed@6?noext",
    };

    function maybeLoadScript(lib, version) {
      var key = `${lib.replace("-", "")}_version`;
      return (VEGA_DEBUG[key] == version) ?
        Promise.resolve(paths[lib]) :
        new Promise(function(resolve, reject) {
          var s = document.createElement('script');
          document.getElementsByTagName("head")[0].appendChild(s);
          s.async = true;
          s.onload = () => {
            VEGA_DEBUG[key] = version;
            return resolve(paths[lib]);
          };
          s.onerror = () => reject(`Error loading script: ${paths[lib]}`);
          s.src = paths[lib];
        });
    }

    function showError(err) {
      outputDiv.innerHTML = `<div class="error" style="color:red;">${err}</div>`;
      throw err;
    }

    function displayChart(vegaEmbed) {
      vegaEmbed(outputDiv, spec, embedOpt)
        .catch(err => showError(`Javascript Error: ${err.message}<br>This usually means there's a typo in your chart specification. See the javascript console for the full traceback.`));
    }

    if(typeof define === "function" && define.amd) {
      requirejs.config({paths});
      let deps = ["vega-embed"];
      require(deps, displayChart, err => showError(`Error loading script: ${err.message}`));
    } else {
      maybeLoadScript("vega", "5")
        .then(() => maybeLoadScript("vega-lite", "5.20.1"))
        .then(() => maybeLoadScript("vega-embed", "6"))
        .catch(showError)
        .then(() => displayChart(vegaEmbed));
    }
  })({"config": {"view": {"continuousWidth": 300, "continuousHeight": 300, "stroke": null}, "legend": {"titleFontSize": 13, "labelFontSize": 12}, "axis": {"titleFontSize": 13, "labelFontSize": 12}, "header": {"titleFontSize": 15, "labelFontSize": 13}}, "layer": [{"data": {"url": "https://cdn.jsdelivr.net/npm/vega-datasets@v1.29.0/data/us-10m.json", "format": {"feature": "states", "type": "topojson"}}, "mark": {"type": "geoshape", "color": "lightgray", "stroke": "white"}, "projection": {"type": "albersUsa"}}, {"data": {"name": "data-4c2b4418d2e44508bf79a511cd28630d"}, "mark": {"type": "circle"}, "encoding": {"latitude": {"field": "latitude", "type": "quantitative"}, "longitude": {"field": "longitude", "type": "quantitative"}, "size": {"field": "population", "type": "quantitative"}}}], "$schema": "https://vega.github.io/schema/vega-lite/v5.20.1.json", "datasets": {"data-4c2b4418d2e44508bf79a511cd28630d": [{"state": "Alabama", "id": 1, "population": 4863300, "latitude": 32.7794, "longitude": -86.8287, "number_of_asthma_cases": 394634}, {"state": "Alaska", "id": 2, "population": 741894, "latitude": 64.0685, "longitude": -152.2782, "number_of_asthma_cases": 50685}, {"state": "Arizona", "id": 4, "population": 6931071, "latitude": 34.2744, "longitude": -111.6602, "number_of_asthma_cases": 545104}, {"state": "Arkansas", "id": 5, "population": 2988248, "latitude": 34.8938, "longitude": -92.4426, "number_of_asthma_cases": 225853}, {"state": "California", "id": 6, "population": 39250017, "latitude": 37.1841, "longitude": -119.4696, "number_of_asthma_cases": 2607598}, {"state": "Colorado", "id": 8, "population": 5540545, "latitude": 38.9972, "longitude": -105.5478, "number_of_asthma_cases": 399357}, {"state": "Connecticut", "id": 9, "population": 3576452, "latitude": 41.6219, "longitude": -72.7273, "number_of_asthma_cases": 290278}, {"state": "Delaware", "id": 10, "population": 952065, "latitude": 38.9896, "longitude": -75.505, "number_of_asthma_cases": 77035}, {"state": "District of Columbia", "id": 11, "population": 681170, "latitude": 38.9101, "longitude": -77.0147, "number_of_asthma_cases": 66441}, {"state": "Florida", "id": 12, "population": 20612439, "latitude": 28.6305, "longitude": -82.4497, "number_of_asthma_cases": 1495632}, {"state": "Georgia", "id": 13, "population": 10310371, "latitude": 32.6415, "longitude": -83.4426, "number_of_asthma_cases": 714569}, {"state": "Hawaii", "id": 15, "population": 1428557, "latitude": 20.2927, "longitude": -156.3737, "number_of_asthma_cases": 104368}, {"state": "Idaho", "id": 16, "population": 1683140, "latitude": 44.3509, "longitude": -114.613, "number_of_asthma_cases": 111954}, {"state": "Illinois", "id": 17, "population": 12801539, "latitude": 40.0417, "longitude": -89.1965, "number_of_asthma_cases": 860007}, {"state": "Indiana", "id": 18, "population": 6633053, "latitude": 39.8942, "longitude": -86.2816, "number_of_asthma_cases": 509651}, {"state": "Iowa", "id": 19, "population": 3134693, "latitude": 42.0751, "longitude": -93.496, "number_of_asthma_cases": 190960}, {"state": "Kansas", "id": 20, "population": 2907289, "latitude": 38.4937, "longitude": -98.3804, "number_of_asthma_cases": 214698}, {"state": "Kentucky", "id": 21, "population": 4436974, "latitude": 37.5347, "longitude": -85.3021, "number_of_asthma_cases": 395345}, {"state": "Louisiana", "id": 22, "population": 4681666, "latitude": 31.0689, "longitude": -91.9968, "number_of_asthma_cases": 316423}, {"state": "Maine", "id": 23, "population": 1331479, "latitude": 45.3695, "longitude": -69.2428, "number_of_asthma_cases": 132126}, {"state": "Maryland", "id": 24, "population": 6016447, "latitude": 39.055, "longitude": -76.7909, "number_of_asthma_cases": 439909}, {"state": "Massachusetts", "id": 25, "population": 6811779, "latitude": 42.2596, "longitude": -71.8083, "number_of_asthma_cases": 558435}, {"state": "Michigan", "id": 26, "population": 9928300, "latitude": 44.3467, "longitude": -85.4102, "number_of_asthma_cases": 872519}, {"state": "Minnesota", "id": 27, "population": 5519952, "latitude": 46.2807, "longitude": -94.3053, "number_of_asthma_cases": 357232}, {"state": "Mississippi", "id": 28, "population": 2988726, "latitude": 32.7364, "longitude": -89.6678, "number_of_asthma_cases": 218223}, {"state": "Missouri", "id": 29, "population": 6093000, "latitude": 38.3566, "longitude": -92.458, "number_of_asthma_cases": 444334}, {"state": "Montana", "id": 30, "population": 1042520, "latitude": 47.0527, "longitude": -109.6333, "number_of_asthma_cases": 82660}, {"state": "Nebraska", "id": 31, "population": 1907116, "latitude": 41.5378, "longitude": -99.7951, "number_of_asthma_cases": 128793}, {"state": "Nevada", "id": 32, "population": 2940058, "latitude": 39.3289, "longitude": -116.6312, "number_of_asthma_cases": 186787}, {"state": "New Hampshire", "id": 33, "population": 1334795, "latitude": 43.6805, "longitude": -71.5811, "number_of_asthma_cases": 128307}, {"state": "New Jersey", "id": 34, "population": 8944469, "latitude": 40.1907, "longitude": -74.6728, "number_of_asthma_cases": 593242}, {"state": "New Mexico", "id": 35, "population": 2081015, "latitude": 34.4071, "longitude": -106.1126, "number_of_asthma_cases": 157177}, {"state": "New York", "id": 36, "population": 19745289, "latitude": 42.9538, "longitude": -75.5268, "number_of_asthma_cases": 1578011}, {"state": "North Carolina", "id": 37, "population": 10146788, "latitude": 35.5557, "longitude": -79.3877, "number_of_asthma_cases": 757790}, {"state": "North Dakota", "id": 38, "population": 757952, "latitude": 47.4501, "longitude": -100.4659, "number_of_asthma_cases": 46996}, {"state": "Ohio", "id": 39, "population": 11614373, "latitude": 40.2862, "longitude": -82.7937, "number_of_asthma_cases": 854186}, {"state": "Oklahoma", "id": 40, "population": 3923561, "latitude": 35.5889, "longitude": -97.4943, "number_of_asthma_cases": 307581}, {"state": "Oregon", "id": 41, "population": 4093465, "latitude": 43.9336, "longitude": -120.5583, "number_of_asthma_cases": 383340}, {"state": "Pennsylvania", "id": 42, "population": 12784227, "latitude": 40.8781, "longitude": -77.7996, "number_of_asthma_cases": 1012588}, {"state": "Rhode Island", "id": 44, "population": 1056426, "latitude": 41.6762, "longitude": -71.5562, "number_of_asthma_cases": 101251}, {"state": "South Carolina", "id": 45, "population": 4961119, "latitude": 33.9169, "longitude": -80.8964, "number_of_asthma_cases": 360353}, {"state": "South Dakota", "id": 46, "population": 865454, "latitude": 44.4443, "longitude": -100.2263, "number_of_asthma_cases": 51652}, {"state": "Tennessee", "id": 47, "population": 6651194, "latitude": 35.85800000000001, "longitude": -86.3505, "number_of_asthma_cases": 513084}, {"state": "Texas", "id": 48, "population": 27862596, "latitude": 31.4757, "longitude": -99.3312, "number_of_asthma_cases": 1572815}, {"state": "Utah", "id": 49, "population": 3051217, "latitude": 39.3055, "longitude": -111.6703, "number_of_asthma_cases": 206360}, {"state": "Vermont", "id": 50, "population": 624594, "latitude": 44.0687, "longitude": -72.6658, "number_of_asthma_cases": 60216}, {"state": "Virginia", "id": 51, "population": 8411808, "latitude": 37.5215, "longitude": -78.8537, "number_of_asthma_cases": 563510}, {"state": "Washington", "id": 53, "population": 7288000, "latitude": 47.3826, "longitude": -120.4472, "number_of_asthma_cases": 558951}, {"state": "West Virginia", "id": 54, "population": 1831102, "latitude": 38.6409, "longitude": -80.6227, "number_of_asthma_cases": 175368}, {"state": "Wisconsin", "id": 55, "population": 5778708, "latitude": 44.6243, "longitude": -89.9941, "number_of_asthma_cases": 408318}, {"state": "Wyoming", "id": 56, "population": 585501, "latitude": 42.9957, "longitude": -107.5512, "number_of_asthma_cases": 38099}]}}, {"mode": "vega-lite"});
</script>
</div>
</div>
<aside class="notes">
<p>One drawback with choropleth maps is that they rely on the area of each region, even if it is unrelated to the measure we are studying.</p>
<p>For example, just because the states in the midwest of the US have a large area, they are very prominent in the choropleth map we made on the last slide although their population is actually quite small.</p>
<p>On the other hand, if there was a state that had a small area, but a large population, we might not even see it on the choropleth map. These issues are often discussed around the US election, where different approach are used to illustrate that the weight of each states’ vote is not tied to the geographical area of the state.</p>
<p>One effective way to convey this message is to use a map as a background and plot points on top that are scaled according to the measure of interest.</p>
<p>To achieve this in Altair, we need one pair of coordinates to plot for each state. For this we can use the columns <code>latitude</code> and <code>longitude</code> which represent the geometric centre of each state).</p>
<p>We then plot these coordinates on top of a map using the special <code>longitude</code> and <code>latitude</code> parameters and set the size of the points to be relative the population.</p>
<p>Finally, we remove the square grey outline by setting the stroke to <code>None</code>.</p>
<p>Now it is much easier to see that many of the states in Eastern USA have a population several times that of the states in the Midwest, although their area is smaller.</p>
<style type="text/css">
        span.MJX_Assistive_MathML {
          position:absolute!important;
          clip: rect(1px, 1px, 1px, 1px);
          padding: 1px 0 0 0!important;
          border: 0!important;
          height: 1px!important;
          width: 1px!important;
          overflow: hidden!important;
          display:block!important;
      }</style></aside>
</section>
<section id="some-measures-can-be-influenced-by-the-population-size" class="slide level2">
<h2>Some measures can be influenced by the population size</h2>
<div id="52d44982" class="cell" data-execution_count="12">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb12-1"><a aria-hidden="true" tabindex="-1"></a>us_map <span class="op">=</span> (alt.Chart(state_map).mark_geoshape(color<span class="op">=</span><span class="st">'lightgray'</span>, stroke<span class="op">=</span><span class="st">'white'</span>)</span>
<span id="cb12-2"><a aria-hidden="true" tabindex="-1"></a>          .project(<span class="bu">type</span><span class="op">=</span><span class="st">'albersUsa'</span>))</span>
<span id="cb12-3"><a aria-hidden="true" tabindex="-1"></a>points <span class="op">=</span> alt.Chart(state_pop).mark_circle().encode(</span>
<span id="cb12-4"><a aria-hidden="true" tabindex="-1"></a>    longitude<span class="op">=</span><span class="st">'longitude'</span>,</span>
<span id="cb12-5"><a aria-hidden="true" tabindex="-1"></a>    latitude<span class="op">=</span><span class="st">'latitude'</span>,</span>
<span id="cb12-6"><a aria-hidden="true" tabindex="-1"></a>    size<span class="op">=</span>alt.Size(<span class="st">'number_of_asthma_cases'</span>, title<span class="op">=</span><span class="st">'Asthma cases'</span>))</span>
<span id="cb12-7"><a aria-hidden="true" tabindex="-1"></a>(us_map <span class="op">+</span> points).configure_view(stroke<span class="op">=</span><span class="va">None</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="12">

<style>
  #altair-viz-bfb3ca8a6cf440e59d3b49be90de509b.vega-embed {
    width: 100%;
    display: flex;
  }

  #altair-viz-bfb3ca8a6cf440e59d3b49be90de509b.vega-embed details,
  #altair-viz-bfb3ca8a6cf440e59d3b49be90de509b.vega-embed details summary {
    position: relative;
  }
</style>
<div id="altair-viz-bfb3ca8a6cf440e59d3b49be90de509b"></div>
<script type="text/javascript">
  var VEGA_DEBUG = (typeof VEGA_DEBUG == "undefined") ? {} : VEGA_DEBUG;
  (function(spec, embedOpt){
    let outputDiv = document.currentScript.previousElementSibling;
    if (outputDiv.id !== "altair-viz-bfb3ca8a6cf440e59d3b49be90de509b") {
      outputDiv = document.getElementById("altair-viz-bfb3ca8a6cf440e59d3b49be90de509b");
    }

    const paths = {
      "vega": "https://cdn.jsdelivr.net/npm/vega@5?noext",
      "vega-lib": "https://cdn.jsdelivr.net/npm/vega-lib?noext",
      "vega-lite": "https://cdn.jsdelivr.net/npm/vega-lite@5.20.1?noext",
      "vega-embed": "https://cdn.jsdelivr.net/npm/vega-embed@6?noext",
    };

    function maybeLoadScript(lib, version) {
      var key = `${lib.replace("-", "")}_version`;
      return (VEGA_DEBUG[key] == version) ?
        Promise.resolve(paths[lib]) :
        new Promise(function(resolve, reject) {
          var s = document.createElement('script');
          document.getElementsByTagName("head")[0].appendChild(s);
          s.async = true;
          s.onload = () => {
            VEGA_DEBUG[key] = version;
            return resolve(paths[lib]);
          };
          s.onerror = () => reject(`Error loading script: ${paths[lib]}`);
          s.src = paths[lib];
        });
    }

    function showError(err) {
      outputDiv.innerHTML = `<div class="error" style="color:red;">${err}</div>`;
      throw err;
    }

    function displayChart(vegaEmbed) {
      vegaEmbed(outputDiv, spec, embedOpt)
        .catch(err => showError(`Javascript Error: ${err.message}<br>This usually means there's a typo in your chart specification. See the javascript console for the full traceback.`));
    }

    if(typeof define === "function" && define.amd) {
      requirejs.config({paths});
      let deps = ["vega-embed"];
      require(deps, displayChart, err => showError(`Error loading script: ${err.message}`));
    } else {
      maybeLoadScript("vega", "5")
        .then(() => maybeLoadScript("vega-lite", "5.20.1"))
        .then(() => maybeLoadScript("vega-embed", "6"))
        .catch(showError)
        .then(() => displayChart(vegaEmbed));
    }
  })({"config": {"view": {"continuousWidth": 300, "continuousHeight": 300, "stroke": null}, "legend": {"titleFontSize": 13, "labelFontSize": 12}, "axis": {"titleFontSize": 13, "labelFontSize": 12}, "header": {"titleFontSize": 15, "labelFontSize": 13}}, "layer": [{"data": {"url": "https://cdn.jsdelivr.net/npm/vega-datasets@v1.29.0/data/us-10m.json", "format": {"feature": "states", "type": "topojson"}}, "mark": {"type": "geoshape", "color": "lightgray", "stroke": "white"}, "projection": {"type": "albersUsa"}}, {"data": {"name": "data-4c2b4418d2e44508bf79a511cd28630d"}, "mark": {"type": "circle"}, "encoding": {"latitude": {"field": "latitude", "type": "quantitative"}, "longitude": {"field": "longitude", "type": "quantitative"}, "size": {"field": "number_of_asthma_cases", "title": "Asthma cases", "type": "quantitative"}}}], "$schema": "https://vega.github.io/schema/vega-lite/v5.20.1.json", "datasets": {"data-4c2b4418d2e44508bf79a511cd28630d": [{"state": "Alabama", "id": 1, "population": 4863300, "latitude": 32.7794, "longitude": -86.8287, "number_of_asthma_cases": 394634}, {"state": "Alaska", "id": 2, "population": 741894, "latitude": 64.0685, "longitude": -152.2782, "number_of_asthma_cases": 50685}, {"state": "Arizona", "id": 4, "population": 6931071, "latitude": 34.2744, "longitude": -111.6602, "number_of_asthma_cases": 545104}, {"state": "Arkansas", "id": 5, "population": 2988248, "latitude": 34.8938, "longitude": -92.4426, "number_of_asthma_cases": 225853}, {"state": "California", "id": 6, "population": 39250017, "latitude": 37.1841, "longitude": -119.4696, "number_of_asthma_cases": 2607598}, {"state": "Colorado", "id": 8, "population": 5540545, "latitude": 38.9972, "longitude": -105.5478, "number_of_asthma_cases": 399357}, {"state": "Connecticut", "id": 9, "population": 3576452, "latitude": 41.6219, "longitude": -72.7273, "number_of_asthma_cases": 290278}, {"state": "Delaware", "id": 10, "population": 952065, "latitude": 38.9896, "longitude": -75.505, "number_of_asthma_cases": 77035}, {"state": "District of Columbia", "id": 11, "population": 681170, "latitude": 38.9101, "longitude": -77.0147, "number_of_asthma_cases": 66441}, {"state": "Florida", "id": 12, "population": 20612439, "latitude": 28.6305, "longitude": -82.4497, "number_of_asthma_cases": 1495632}, {"state": "Georgia", "id": 13, "population": 10310371, "latitude": 32.6415, "longitude": -83.4426, "number_of_asthma_cases": 714569}, {"state": "Hawaii", "id": 15, "population": 1428557, "latitude": 20.2927, "longitude": -156.3737, "number_of_asthma_cases": 104368}, {"state": "Idaho", "id": 16, "population": 1683140, "latitude": 44.3509, "longitude": -114.613, "number_of_asthma_cases": 111954}, {"state": "Illinois", "id": 17, "population": 12801539, "latitude": 40.0417, "longitude": -89.1965, "number_of_asthma_cases": 860007}, {"state": "Indiana", "id": 18, "population": 6633053, "latitude": 39.8942, "longitude": -86.2816, "number_of_asthma_cases": 509651}, {"state": "Iowa", "id": 19, "population": 3134693, "latitude": 42.0751, "longitude": -93.496, "number_of_asthma_cases": 190960}, {"state": "Kansas", "id": 20, "population": 2907289, "latitude": 38.4937, "longitude": -98.3804, "number_of_asthma_cases": 214698}, {"state": "Kentucky", "id": 21, "population": 4436974, "latitude": 37.5347, "longitude": -85.3021, "number_of_asthma_cases": 395345}, {"state": "Louisiana", "id": 22, "population": 4681666, "latitude": 31.0689, "longitude": -91.9968, "number_of_asthma_cases": 316423}, {"state": "Maine", "id": 23, "population": 1331479, "latitude": 45.3695, "longitude": -69.2428, "number_of_asthma_cases": 132126}, {"state": "Maryland", "id": 24, "population": 6016447, "latitude": 39.055, "longitude": -76.7909, "number_of_asthma_cases": 439909}, {"state": "Massachusetts", "id": 25, "population": 6811779, "latitude": 42.2596, "longitude": -71.8083, "number_of_asthma_cases": 558435}, {"state": "Michigan", "id": 26, "population": 9928300, "latitude": 44.3467, "longitude": -85.4102, "number_of_asthma_cases": 872519}, {"state": "Minnesota", "id": 27, "population": 5519952, "latitude": 46.2807, "longitude": -94.3053, "number_of_asthma_cases": 357232}, {"state": "Mississippi", "id": 28, "population": 2988726, "latitude": 32.7364, "longitude": -89.6678, "number_of_asthma_cases": 218223}, {"state": "Missouri", "id": 29, "population": 6093000, "latitude": 38.3566, "longitude": -92.458, "number_of_asthma_cases": 444334}, {"state": "Montana", "id": 30, "population": 1042520, "latitude": 47.0527, "longitude": -109.6333, "number_of_asthma_cases": 82660}, {"state": "Nebraska", "id": 31, "population": 1907116, "latitude": 41.5378, "longitude": -99.7951, "number_of_asthma_cases": 128793}, {"state": "Nevada", "id": 32, "population": 2940058, "latitude": 39.3289, "longitude": -116.6312, "number_of_asthma_cases": 186787}, {"state": "New Hampshire", "id": 33, "population": 1334795, "latitude": 43.6805, "longitude": -71.5811, "number_of_asthma_cases": 128307}, {"state": "New Jersey", "id": 34, "population": 8944469, "latitude": 40.1907, "longitude": -74.6728, "number_of_asthma_cases": 593242}, {"state": "New Mexico", "id": 35, "population": 2081015, "latitude": 34.4071, "longitude": -106.1126, "number_of_asthma_cases": 157177}, {"state": "New York", "id": 36, "population": 19745289, "latitude": 42.9538, "longitude": -75.5268, "number_of_asthma_cases": 1578011}, {"state": "North Carolina", "id": 37, "population": 10146788, "latitude": 35.5557, "longitude": -79.3877, "number_of_asthma_cases": 757790}, {"state": "North Dakota", "id": 38, "population": 757952, "latitude": 47.4501, "longitude": -100.4659, "number_of_asthma_cases": 46996}, {"state": "Ohio", "id": 39, "population": 11614373, "latitude": 40.2862, "longitude": -82.7937, "number_of_asthma_cases": 854186}, {"state": "Oklahoma", "id": 40, "population": 3923561, "latitude": 35.5889, "longitude": -97.4943, "number_of_asthma_cases": 307581}, {"state": "Oregon", "id": 41, "population": 4093465, "latitude": 43.9336, "longitude": -120.5583, "number_of_asthma_cases": 383340}, {"state": "Pennsylvania", "id": 42, "population": 12784227, "latitude": 40.8781, "longitude": -77.7996, "number_of_asthma_cases": 1012588}, {"state": "Rhode Island", "id": 44, "population": 1056426, "latitude": 41.6762, "longitude": -71.5562, "number_of_asthma_cases": 101251}, {"state": "South Carolina", "id": 45, "population": 4961119, "latitude": 33.9169, "longitude": -80.8964, "number_of_asthma_cases": 360353}, {"state": "South Dakota", "id": 46, "population": 865454, "latitude": 44.4443, "longitude": -100.2263, "number_of_asthma_cases": 51652}, {"state": "Tennessee", "id": 47, "population": 6651194, "latitude": 35.85800000000001, "longitude": -86.3505, "number_of_asthma_cases": 513084}, {"state": "Texas", "id": 48, "population": 27862596, "latitude": 31.4757, "longitude": -99.3312, "number_of_asthma_cases": 1572815}, {"state": "Utah", "id": 49, "population": 3051217, "latitude": 39.3055, "longitude": -111.6703, "number_of_asthma_cases": 206360}, {"state": "Vermont", "id": 50, "population": 624594, "latitude": 44.0687, "longitude": -72.6658, "number_of_asthma_cases": 60216}, {"state": "Virginia", "id": 51, "population": 8411808, "latitude": 37.5215, "longitude": -78.8537, "number_of_asthma_cases": 563510}, {"state": "Washington", "id": 53, "population": 7288000, "latitude": 47.3826, "longitude": -120.4472, "number_of_asthma_cases": 558951}, {"state": "West Virginia", "id": 54, "population": 1831102, "latitude": 38.6409, "longitude": -80.6227, "number_of_asthma_cases": 175368}, {"state": "Wisconsin", "id": 55, "population": 5778708, "latitude": 44.6243, "longitude": -89.9941, "number_of_asthma_cases": 408318}, {"state": "Wyoming", "id": 56, "population": 585501, "latitude": 42.9957, "longitude": -107.5512, "number_of_asthma_cases": 38099}]}}, {"mode": "vega-lite"});
</script>
</div>
</div>
<aside class="notes">
<p>Whether we are using a choropleth or a map with circular markers, we need to be careful when plotting variables that depend on the population size.</p>
<p>In this plot we have plotted the number of people suffering from asthma in each of the states.</p>
<p>As you can see, this looks almost identical to the map in the last slide showing the population per state. The reason is that for any condition, a state with more people is likely to show more cases, unless there is a strong dependence on another factor that differs between the states.</p>
<p>It would be more interesting to see how many people get asthma per capita, which means dividing the number of asthma cases with the population in each state.</p>
<p>Let’s do that next!</p>
<style type="text/css">
        span.MJX_Assistive_MathML {
          position:absolute!important;
          clip: rect(1px, 1px, 1px, 1px);
          padding: 1px 0 0 0!important;
          border: 0!important;
          height: 1px!important;
          width: 1px!important;
          overflow: hidden!important;
          display:block!important;
      }</style></aside>
</section>
<section id="for-these-measures-it-is-important-to-control-for-the-size-of-population" class="slide level2">
<h2>For these measures it is important to control for the size of population</h2>
<div id="2fb2ab89" class="cell" data-execution_count="13">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb13-1"><a aria-hidden="true" tabindex="-1"></a>state_pop[<span class="st">'asthma_cases_per_capita'</span>] <span class="op">=</span> state_pop[<span class="st">'number_of_asthma_cases'</span>] <span class="op">/</span> state_pop[<span class="st">'population'</span>]</span>
<span id="cb13-2"><a aria-hidden="true" tabindex="-1"></a>us_map <span class="op">=</span> (alt.Chart(state_map).mark_geoshape(color<span class="op">=</span><span class="st">'lightgray'</span>, stroke<span class="op">=</span><span class="st">'white'</span>)</span>
<span id="cb13-3"><a aria-hidden="true" tabindex="-1"></a>          .project(<span class="bu">type</span><span class="op">=</span><span class="st">'albersUsa'</span>))</span>
<span id="cb13-4"><a aria-hidden="true" tabindex="-1"></a>points <span class="op">=</span> alt.Chart(state_pop).mark_circle().encode(</span>
<span id="cb13-5"><a aria-hidden="true" tabindex="-1"></a>    longitude<span class="op">=</span><span class="st">'longitude'</span>,</span>
<span id="cb13-6"><a aria-hidden="true" tabindex="-1"></a>    latitude<span class="op">=</span><span class="st">'latitude'</span>,</span>
<span id="cb13-7"><a aria-hidden="true" tabindex="-1"></a>    size<span class="op">=</span>alt.Size(<span class="st">'asthma_cases_per_capita'</span>, title<span class="op">=</span><span class="st">'Asthma cases'</span>))</span>
<span id="cb13-8"><a aria-hidden="true" tabindex="-1"></a>(us_map <span class="op">+</span> points).configure_view(stroke<span class="op">=</span><span class="va">None</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="13">

<style>
  #altair-viz-76363c3cf5e742c381abd24771791e5a.vega-embed {
    width: 100%;
    display: flex;
  }

  #altair-viz-76363c3cf5e742c381abd24771791e5a.vega-embed details,
  #altair-viz-76363c3cf5e742c381abd24771791e5a.vega-embed details summary {
    position: relative;
  }
</style>
<div id="altair-viz-76363c3cf5e742c381abd24771791e5a"></div>
<script type="text/javascript">
  var VEGA_DEBUG = (typeof VEGA_DEBUG == "undefined") ? {} : VEGA_DEBUG;
  (function(spec, embedOpt){
    let outputDiv = document.currentScript.previousElementSibling;
    if (outputDiv.id !== "altair-viz-76363c3cf5e742c381abd24771791e5a") {
      outputDiv = document.getElementById("altair-viz-76363c3cf5e742c381abd24771791e5a");
    }

    const paths = {
      "vega": "https://cdn.jsdelivr.net/npm/vega@5?noext",
      "vega-lib": "https://cdn.jsdelivr.net/npm/vega-lib?noext",
      "vega-lite": "https://cdn.jsdelivr.net/npm/vega-lite@5.20.1?noext",
      "vega-embed": "https://cdn.jsdelivr.net/npm/vega-embed@6?noext",
    };

    function maybeLoadScript(lib, version) {
      var key = `${lib.replace("-", "")}_version`;
      return (VEGA_DEBUG[key] == version) ?
        Promise.resolve(paths[lib]) :
        new Promise(function(resolve, reject) {
          var s = document.createElement('script');
          document.getElementsByTagName("head")[0].appendChild(s);
          s.async = true;
          s.onload = () => {
            VEGA_DEBUG[key] = version;
            return resolve(paths[lib]);
          };
          s.onerror = () => reject(`Error loading script: ${paths[lib]}`);
          s.src = paths[lib];
        });
    }

    function showError(err) {
      outputDiv.innerHTML = `<div class="error" style="color:red;">${err}</div>`;
      throw err;
    }

    function displayChart(vegaEmbed) {
      vegaEmbed(outputDiv, spec, embedOpt)
        .catch(err => showError(`Javascript Error: ${err.message}<br>This usually means there's a typo in your chart specification. See the javascript console for the full traceback.`));
    }

    if(typeof define === "function" && define.amd) {
      requirejs.config({paths});
      let deps = ["vega-embed"];
      require(deps, displayChart, err => showError(`Error loading script: ${err.message}`));
    } else {
      maybeLoadScript("vega", "5")
        .then(() => maybeLoadScript("vega-lite", "5.20.1"))
        .then(() => maybeLoadScript("vega-embed", "6"))
        .catch(showError)
        .then(() => displayChart(vegaEmbed));
    }
  })({"config": {"view": {"continuousWidth": 300, "continuousHeight": 300, "stroke": null}, "legend": {"titleFontSize": 13, "labelFontSize": 12}, "axis": {"titleFontSize": 13, "labelFontSize": 12}, "header": {"titleFontSize": 15, "labelFontSize": 13}}, "layer": [{"data": {"url": "https://cdn.jsdelivr.net/npm/vega-datasets@v1.29.0/data/us-10m.json", "format": {"feature": "states", "type": "topojson"}}, "mark": {"type": "geoshape", "color": "lightgray", "stroke": "white"}, "projection": {"type": "albersUsa"}}, {"data": {"name": "data-4acfa937387f9b7b32d43a126af5b75d"}, "mark": {"type": "circle"}, "encoding": {"latitude": {"field": "latitude", "type": "quantitative"}, "longitude": {"field": "longitude", "type": "quantitative"}, "size": {"field": "asthma_cases_per_capita", "title": "Asthma cases", "type": "quantitative"}}}], "$schema": "https://vega.github.io/schema/vega-lite/v5.20.1.json", "datasets": {"data-4acfa937387f9b7b32d43a126af5b75d": [{"state": "Alabama", "id": 1, "population": 4863300, "latitude": 32.7794, "longitude": -86.8287, "number_of_asthma_cases": 394634, "asthma_cases_per_capita": 0.0811453128534123}, {"state": "Alaska", "id": 2, "population": 741894, "latitude": 64.0685, "longitude": -152.2782, "number_of_asthma_cases": 50685, "asthma_cases_per_capita": 0.06831838510622812}, {"state": "Arizona", "id": 4, "population": 6931071, "latitude": 34.2744, "longitude": -111.6602, "number_of_asthma_cases": 545104, "asthma_cases_per_capita": 0.07864643141009521}, {"state": "Arkansas", "id": 5, "population": 2988248, "latitude": 34.8938, "longitude": -92.4426, "number_of_asthma_cases": 225853, "asthma_cases_per_capita": 0.0755804069809467}, {"state": "California", "id": 6, "population": 39250017, "latitude": 37.1841, "longitude": -119.4696, "number_of_asthma_cases": 2607598, "asthma_cases_per_capita": 0.06643558905974487}, {"state": "Colorado", "id": 8, "population": 5540545, "latitude": 38.9972, "longitude": -105.5478, "number_of_asthma_cases": 399357, "asthma_cases_per_capita": 0.07207901027786978}, {"state": "Connecticut", "id": 9, "population": 3576452, "latitude": 41.6219, "longitude": -72.7273, "number_of_asthma_cases": 290278, "asthma_cases_per_capita": 0.0811636784164865}, {"state": "Delaware", "id": 10, "population": 952065, "latitude": 38.9896, "longitude": -75.505, "number_of_asthma_cases": 77035, "asthma_cases_per_capita": 0.08091359308450578}, {"state": "District of Columbia", "id": 11, "population": 681170, "latitude": 38.9101, "longitude": -77.0147, "number_of_asthma_cases": 66441, "asthma_cases_per_capita": 0.0975395275775504}, {"state": "Florida", "id": 12, "population": 20612439, "latitude": 28.6305, "longitude": -82.4497, "number_of_asthma_cases": 1495632, "asthma_cases_per_capita": 0.07255968107413198}, {"state": "Georgia", "id": 13, "population": 10310371, "latitude": 32.6415, "longitude": -83.4426, "number_of_asthma_cases": 714569, "asthma_cases_per_capita": 0.06930584748114302}, {"state": "Hawaii", "id": 15, "population": 1428557, "latitude": 20.2927, "longitude": -156.3737, "number_of_asthma_cases": 104368, "asthma_cases_per_capita": 0.07305833788921268}, {"state": "Idaho", "id": 16, "population": 1683140, "latitude": 44.3509, "longitude": -114.613, "number_of_asthma_cases": 111954, "asthma_cases_per_capita": 0.06651496607531163}, {"state": "Illinois", "id": 17, "population": 12801539, "latitude": 40.0417, "longitude": -89.1965, "number_of_asthma_cases": 860007, "asthma_cases_per_capita": 0.06717996953335063}, {"state": "Indiana", "id": 18, "population": 6633053, "latitude": 39.8942, "longitude": -86.2816, "number_of_asthma_cases": 509651, "asthma_cases_per_capita": 0.07683505619508844}, {"state": "Iowa", "id": 19, "population": 3134693, "latitude": 42.0751, "longitude": -93.496, "number_of_asthma_cases": 190960, "asthma_cases_per_capita": 0.06091824622060278}, {"state": "Kansas", "id": 20, "population": 2907289, "latitude": 38.4937, "longitude": -98.3804, "number_of_asthma_cases": 214698, "asthma_cases_per_capita": 0.07384817952394826}, {"state": "Kentucky", "id": 21, "population": 4436974, "latitude": 37.5347, "longitude": -85.3021, "number_of_asthma_cases": 395345, "asthma_cases_per_capita": 0.08910239275686538}, {"state": "Louisiana", "id": 22, "population": 4681666, "latitude": 31.0689, "longitude": -91.9968, "number_of_asthma_cases": 316423, "asthma_cases_per_capita": 0.06758769207371905}, {"state": "Maine", "id": 23, "population": 1331479, "latitude": 45.3695, "longitude": -69.2428, "number_of_asthma_cases": 132126, "asthma_cases_per_capita": 0.09923250760995855}, {"state": "Maryland", "id": 24, "population": 6016447, "latitude": 39.055, "longitude": -76.7909, "number_of_asthma_cases": 439909, "asthma_cases_per_capita": 0.07311773875843999}, {"state": "Massachusetts", "id": 25, "population": 6811779, "latitude": 42.2596, "longitude": -71.8083, "number_of_asthma_cases": 558435, "asthma_cases_per_capita": 0.08198078651700239}, {"state": "Michigan", "id": 26, "population": 9928300, "latitude": 44.3467, "longitude": -85.4102, "number_of_asthma_cases": 872519, "asthma_cases_per_capita": 0.08788201404067161}, {"state": "Minnesota", "id": 27, "population": 5519952, "latitude": 46.2807, "longitude": -94.3053, "number_of_asthma_cases": 357232, "asthma_cases_per_capita": 0.064716504781201}, {"state": "Mississippi", "id": 28, "population": 2988726, "latitude": 32.7364, "longitude": -89.6678, "number_of_asthma_cases": 218223, "asthma_cases_per_capita": 0.07301539184254428}, {"state": "Missouri", "id": 29, "population": 6093000, "latitude": 38.3566, "longitude": -92.458, "number_of_asthma_cases": 444334, "asthma_cases_per_capita": 0.07292532414245856}, {"state": "Montana", "id": 30, "population": 1042520, "latitude": 47.0527, "longitude": -109.6333, "number_of_asthma_cases": 82660, "asthma_cases_per_capita": 0.07928864674059011}, {"state": "Nebraska", "id": 31, "population": 1907116, "latitude": 41.5378, "longitude": -99.7951, "number_of_asthma_cases": 128793, "asthma_cases_per_capita": 0.06753286113692088}, {"state": "Nevada", "id": 32, "population": 2940058, "latitude": 39.3289, "longitude": -116.6312, "number_of_asthma_cases": 186787, "asthma_cases_per_capita": 0.06353173985003017}, {"state": "New Hampshire", "id": 33, "population": 1334795, "latitude": 43.6805, "longitude": -71.5811, "number_of_asthma_cases": 128307, "asthma_cases_per_capita": 0.09612487310785552}, {"state": "New Jersey", "id": 34, "population": 8944469, "latitude": 40.1907, "longitude": -74.6728, "number_of_asthma_cases": 593242, "asthma_cases_per_capita": 0.06632501046177253}, {"state": "New Mexico", "id": 35, "population": 2081015, "latitude": 34.4071, "longitude": -106.1126, "number_of_asthma_cases": 157177, "asthma_cases_per_capita": 0.07552900868086006}, {"state": "New York", "id": 36, "population": 19745289, "latitude": 42.9538, "longitude": -75.5268, "number_of_asthma_cases": 1578011, "asthma_cases_per_capita": 0.07991835419577804}, {"state": "North Carolina", "id": 37, "population": 10146788, "latitude": 35.5557, "longitude": -79.3877, "number_of_asthma_cases": 757790, "asthma_cases_per_capita": 0.07468274689487944}, {"state": "North Dakota", "id": 38, "population": 757952, "latitude": 47.4501, "longitude": -100.4659, "number_of_asthma_cases": 46996, "asthma_cases_per_capita": 0.0620039263700076}, {"state": "Ohio", "id": 39, "population": 11614373, "latitude": 40.2862, "longitude": -82.7937, "number_of_asthma_cases": 854186, "asthma_cases_per_capita": 0.0735455973387457}, {"state": "Oklahoma", "id": 40, "population": 3923561, "latitude": 35.5889, "longitude": -97.4943, "number_of_asthma_cases": 307581, "asthma_cases_per_capita": 0.07839332687831284}, {"state": "Oregon", "id": 41, "population": 4093465, "latitude": 43.9336, "longitude": -120.5583, "number_of_asthma_cases": 383340, "asthma_cases_per_capita": 0.09364682487819}, {"state": "Pennsylvania", "id": 42, "population": 12784227, "latitude": 40.8781, "longitude": -77.7996, "number_of_asthma_cases": 1012588, "asthma_cases_per_capita": 0.07920604038085369}, {"state": "Rhode Island", "id": 44, "population": 1056426, "latitude": 41.6762, "longitude": -71.5562, "number_of_asthma_cases": 101251, "asthma_cases_per_capita": 0.09584296486455275}, {"state": "South Carolina", "id": 45, "population": 4961119, "latitude": 33.9169, "longitude": -80.8964, "number_of_asthma_cases": 360353, "asthma_cases_per_capita": 0.07263542761219798}, {"state": "South Dakota", "id": 46, "population": 865454, "latitude": 44.4443, "longitude": -100.2263, "number_of_asthma_cases": 51652, "asthma_cases_per_capita": 0.05968197038779646}, {"state": "Tennessee", "id": 47, "population": 6651194, "latitude": 35.85800000000001, "longitude": -86.3505, "number_of_asthma_cases": 513084, "asthma_cases_per_capita": 0.07714163802769848}, {"state": "Texas", "id": 48, "population": 27862596, "latitude": 31.4757, "longitude": -99.3312, "number_of_asthma_cases": 1572815, "asthma_cases_per_capita": 0.056448975536952835}, {"state": "Utah", "id": 49, "population": 3051217, "latitude": 39.3055, "longitude": -111.6703, "number_of_asthma_cases": 206360, "asthma_cases_per_capita": 0.06763203010470904}, {"state": "Vermont", "id": 50, "population": 624594, "latitude": 44.0687, "longitude": -72.6658, "number_of_asthma_cases": 60216, "asthma_cases_per_capita": 0.09640822678411896}, {"state": "Virginia", "id": 51, "population": 8411808, "latitude": 37.5215, "longitude": -78.8537, "number_of_asthma_cases": 563510, "asthma_cases_per_capita": 0.06699035451118238}, {"state": "Washington", "id": 53, "population": 7288000, "latitude": 47.3826, "longitude": -120.4472, "number_of_asthma_cases": 558951, "asthma_cases_per_capita": 0.07669470362239297}, {"state": "West Virginia", "id": 54, "population": 1831102, "latitude": 38.6409, "longitude": -80.6227, "number_of_asthma_cases": 175368, "asthma_cases_per_capita": 0.09577183575792064}, {"state": "Wisconsin", "id": 55, "population": 5778708, "latitude": 44.6243, "longitude": -89.9941, "number_of_asthma_cases": 408318, "asthma_cases_per_capita": 0.07065904697036085}, {"state": "Wyoming", "id": 56, "population": 585501, "latitude": 42.9957, "longitude": -107.5512, "number_of_asthma_cases": 38099, "asthma_cases_per_capita": 0.06507076845300008}]}}, {"mode": "vega-lite"});
</script>
</div>
</div>
<aside class="notes">
<p>When we control for the size of the population in each state, we can see that the appearance of the map is quite different.</p>
<p>Most state has a rather similar number of asthma cases per capita, differing at most with around 1.5 - 2x.</p>
<p>It a bit hard to see the exact with the size of the circles since the scale starts from zero.</p>
<p>If these small differences are important, we could set the domain of the size scale in the same way we saw in previous modules how we could adjust the domain for the x and y scales.</p>
<p>However, there is a bigger issue with this visualization. Look at the circles in the Eastern US, many of them are overlapping which makes the chart hard to read.</p>
<p>We make all points smaller by setting the range of the size scale, but there would still be a lot of overlap.</p>
<p>In these cases, a choropleth map would be a better choice since there won’t be any overlap.</p>
<style type="text/css">
        span.MJX_Assistive_MathML {
          position:absolute!important;
          clip: rect(1px, 1px, 1px, 1px);
          padding: 1px 0 0 0!important;
          border: 0!important;
          height: 1px!important;
          width: 1px!important;
          overflow: hidden!important;
          display:block!important;
      }</style></aside>
</section>
<section id="a-choropleth-map-avoids-overlap-for-large-values-close-to-each-other" class="slide level2">
<h2>A choropleth map avoids overlap for large values close to each other</h2>
<div id="f236e525" class="cell" data-execution_count="14">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb14-1"><a aria-hidden="true" tabindex="-1"></a>(alt.Chart(state_map).mark_geoshape().transform_lookup(</span>
<span id="cb14-2"><a aria-hidden="true" tabindex="-1"></a>    lookup<span class="op">=</span><span class="st">'id'</span>,</span>
<span id="cb14-3"><a aria-hidden="true" tabindex="-1"></a>    from_<span class="op">=</span>alt.LookupData(state_pop, <span class="st">'id'</span>, [<span class="st">'asthma_cases_per_capita'</span>]))</span>
<span id="cb14-4"><a aria-hidden="true" tabindex="-1"></a>.encode(color<span class="op">=</span><span class="st">'asthma_cases_per_capita:Q'</span>)</span>
<span id="cb14-5"><a aria-hidden="true" tabindex="-1"></a>.project(<span class="bu">type</span><span class="op">=</span><span class="st">'albersUsa'</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="14">

<style>
  #altair-viz-ce162660b77c455dbc8edc9bde642fc7.vega-embed {
    width: 100%;
    display: flex;
  }

  #altair-viz-ce162660b77c455dbc8edc9bde642fc7.vega-embed details,
  #altair-viz-ce162660b77c455dbc8edc9bde642fc7.vega-embed details summary {
    position: relative;
  }
</style>
<div id="altair-viz-ce162660b77c455dbc8edc9bde642fc7"></div>
<script type="text/javascript">
  var VEGA_DEBUG = (typeof VEGA_DEBUG == "undefined") ? {} : VEGA_DEBUG;
  (function(spec, embedOpt){
    let outputDiv = document.currentScript.previousElementSibling;
    if (outputDiv.id !== "altair-viz-ce162660b77c455dbc8edc9bde642fc7") {
      outputDiv = document.getElementById("altair-viz-ce162660b77c455dbc8edc9bde642fc7");
    }

    const paths = {
      "vega": "https://cdn.jsdelivr.net/npm/vega@5?noext",
      "vega-lib": "https://cdn.jsdelivr.net/npm/vega-lib?noext",
      "vega-lite": "https://cdn.jsdelivr.net/npm/vega-lite@5.20.1?noext",
      "vega-embed": "https://cdn.jsdelivr.net/npm/vega-embed@6?noext",
    };

    function maybeLoadScript(lib, version) {
      var key = `${lib.replace("-", "")}_version`;
      return (VEGA_DEBUG[key] == version) ?
        Promise.resolve(paths[lib]) :
        new Promise(function(resolve, reject) {
          var s = document.createElement('script');
          document.getElementsByTagName("head")[0].appendChild(s);
          s.async = true;
          s.onload = () => {
            VEGA_DEBUG[key] = version;
            return resolve(paths[lib]);
          };
          s.onerror = () => reject(`Error loading script: ${paths[lib]}`);
          s.src = paths[lib];
        });
    }

    function showError(err) {
      outputDiv.innerHTML = `<div class="error" style="color:red;">${err}</div>`;
      throw err;
    }

    function displayChart(vegaEmbed) {
      vegaEmbed(outputDiv, spec, embedOpt)
        .catch(err => showError(`Javascript Error: ${err.message}<br>This usually means there's a typo in your chart specification. See the javascript console for the full traceback.`));
    }

    if(typeof define === "function" && define.amd) {
      requirejs.config({paths});
      let deps = ["vega-embed"];
      require(deps, displayChart, err => showError(`Error loading script: ${err.message}`));
    } else {
      maybeLoadScript("vega", "5")
        .then(() => maybeLoadScript("vega-lite", "5.20.1"))
        .then(() => maybeLoadScript("vega-embed", "6"))
        .catch(showError)
        .then(() => displayChart(vegaEmbed));
    }
  })({"config": {"view": {"continuousWidth": 300, "continuousHeight": 300}, "legend": {"titleFontSize": 13, "labelFontSize": 12}, "axis": {"titleFontSize": 13, "labelFontSize": 12}, "header": {"titleFontSize": 15, "labelFontSize": 13}}, "data": {"url": "https://cdn.jsdelivr.net/npm/vega-datasets@v1.29.0/data/us-10m.json", "format": {"feature": "states", "type": "topojson"}}, "mark": {"type": "geoshape"}, "encoding": {"color": {"field": "asthma_cases_per_capita", "type": "quantitative"}}, "projection": {"type": "albersUsa"}, "transform": [{"lookup": "id", "from": {"data": {"name": "data-4acfa937387f9b7b32d43a126af5b75d"}, "key": "id", "fields": ["asthma_cases_per_capita"]}}], "$schema": "https://vega.github.io/schema/vega-lite/v5.20.1.json", "datasets": {"data-4acfa937387f9b7b32d43a126af5b75d": [{"state": "Alabama", "id": 1, "population": 4863300, "latitude": 32.7794, "longitude": -86.8287, "number_of_asthma_cases": 394634, "asthma_cases_per_capita": 0.0811453128534123}, {"state": "Alaska", "id": 2, "population": 741894, "latitude": 64.0685, "longitude": -152.2782, "number_of_asthma_cases": 50685, "asthma_cases_per_capita": 0.06831838510622812}, {"state": "Arizona", "id": 4, "population": 6931071, "latitude": 34.2744, "longitude": -111.6602, "number_of_asthma_cases": 545104, "asthma_cases_per_capita": 0.07864643141009521}, {"state": "Arkansas", "id": 5, "population": 2988248, "latitude": 34.8938, "longitude": -92.4426, "number_of_asthma_cases": 225853, "asthma_cases_per_capita": 0.0755804069809467}, {"state": "California", "id": 6, "population": 39250017, "latitude": 37.1841, "longitude": -119.4696, "number_of_asthma_cases": 2607598, "asthma_cases_per_capita": 0.06643558905974487}, {"state": "Colorado", "id": 8, "population": 5540545, "latitude": 38.9972, "longitude": -105.5478, "number_of_asthma_cases": 399357, "asthma_cases_per_capita": 0.07207901027786978}, {"state": "Connecticut", "id": 9, "population": 3576452, "latitude": 41.6219, "longitude": -72.7273, "number_of_asthma_cases": 290278, "asthma_cases_per_capita": 0.0811636784164865}, {"state": "Delaware", "id": 10, "population": 952065, "latitude": 38.9896, "longitude": -75.505, "number_of_asthma_cases": 77035, "asthma_cases_per_capita": 0.08091359308450578}, {"state": "District of Columbia", "id": 11, "population": 681170, "latitude": 38.9101, "longitude": -77.0147, "number_of_asthma_cases": 66441, "asthma_cases_per_capita": 0.0975395275775504}, {"state": "Florida", "id": 12, "population": 20612439, "latitude": 28.6305, "longitude": -82.4497, "number_of_asthma_cases": 1495632, "asthma_cases_per_capita": 0.07255968107413198}, {"state": "Georgia", "id": 13, "population": 10310371, "latitude": 32.6415, "longitude": -83.4426, "number_of_asthma_cases": 714569, "asthma_cases_per_capita": 0.06930584748114302}, {"state": "Hawaii", "id": 15, "population": 1428557, "latitude": 20.2927, "longitude": -156.3737, "number_of_asthma_cases": 104368, "asthma_cases_per_capita": 0.07305833788921268}, {"state": "Idaho", "id": 16, "population": 1683140, "latitude": 44.3509, "longitude": -114.613, "number_of_asthma_cases": 111954, "asthma_cases_per_capita": 0.06651496607531163}, {"state": "Illinois", "id": 17, "population": 12801539, "latitude": 40.0417, "longitude": -89.1965, "number_of_asthma_cases": 860007, "asthma_cases_per_capita": 0.06717996953335063}, {"state": "Indiana", "id": 18, "population": 6633053, "latitude": 39.8942, "longitude": -86.2816, "number_of_asthma_cases": 509651, "asthma_cases_per_capita": 0.07683505619508844}, {"state": "Iowa", "id": 19, "population": 3134693, "latitude": 42.0751, "longitude": -93.496, "number_of_asthma_cases": 190960, "asthma_cases_per_capita": 0.06091824622060278}, {"state": "Kansas", "id": 20, "population": 2907289, "latitude": 38.4937, "longitude": -98.3804, "number_of_asthma_cases": 214698, "asthma_cases_per_capita": 0.07384817952394826}, {"state": "Kentucky", "id": 21, "population": 4436974, "latitude": 37.5347, "longitude": -85.3021, "number_of_asthma_cases": 395345, "asthma_cases_per_capita": 0.08910239275686538}, {"state": "Louisiana", "id": 22, "population": 4681666, "latitude": 31.0689, "longitude": -91.9968, "number_of_asthma_cases": 316423, "asthma_cases_per_capita": 0.06758769207371905}, {"state": "Maine", "id": 23, "population": 1331479, "latitude": 45.3695, "longitude": -69.2428, "number_of_asthma_cases": 132126, "asthma_cases_per_capita": 0.09923250760995855}, {"state": "Maryland", "id": 24, "population": 6016447, "latitude": 39.055, "longitude": -76.7909, "number_of_asthma_cases": 439909, "asthma_cases_per_capita": 0.07311773875843999}, {"state": "Massachusetts", "id": 25, "population": 6811779, "latitude": 42.2596, "longitude": -71.8083, "number_of_asthma_cases": 558435, "asthma_cases_per_capita": 0.08198078651700239}, {"state": "Michigan", "id": 26, "population": 9928300, "latitude": 44.3467, "longitude": -85.4102, "number_of_asthma_cases": 872519, "asthma_cases_per_capita": 0.08788201404067161}, {"state": "Minnesota", "id": 27, "population": 5519952, "latitude": 46.2807, "longitude": -94.3053, "number_of_asthma_cases": 357232, "asthma_cases_per_capita": 0.064716504781201}, {"state": "Mississippi", "id": 28, "population": 2988726, "latitude": 32.7364, "longitude": -89.6678, "number_of_asthma_cases": 218223, "asthma_cases_per_capita": 0.07301539184254428}, {"state": "Missouri", "id": 29, "population": 6093000, "latitude": 38.3566, "longitude": -92.458, "number_of_asthma_cases": 444334, "asthma_cases_per_capita": 0.07292532414245856}, {"state": "Montana", "id": 30, "population": 1042520, "latitude": 47.0527, "longitude": -109.6333, "number_of_asthma_cases": 82660, "asthma_cases_per_capita": 0.07928864674059011}, {"state": "Nebraska", "id": 31, "population": 1907116, "latitude": 41.5378, "longitude": -99.7951, "number_of_asthma_cases": 128793, "asthma_cases_per_capita": 0.06753286113692088}, {"state": "Nevada", "id": 32, "population": 2940058, "latitude": 39.3289, "longitude": -116.6312, "number_of_asthma_cases": 186787, "asthma_cases_per_capita": 0.06353173985003017}, {"state": "New Hampshire", "id": 33, "population": 1334795, "latitude": 43.6805, "longitude": -71.5811, "number_of_asthma_cases": 128307, "asthma_cases_per_capita": 0.09612487310785552}, {"state": "New Jersey", "id": 34, "population": 8944469, "latitude": 40.1907, "longitude": -74.6728, "number_of_asthma_cases": 593242, "asthma_cases_per_capita": 0.06632501046177253}, {"state": "New Mexico", "id": 35, "population": 2081015, "latitude": 34.4071, "longitude": -106.1126, "number_of_asthma_cases": 157177, "asthma_cases_per_capita": 0.07552900868086006}, {"state": "New York", "id": 36, "population": 19745289, "latitude": 42.9538, "longitude": -75.5268, "number_of_asthma_cases": 1578011, "asthma_cases_per_capita": 0.07991835419577804}, {"state": "North Carolina", "id": 37, "population": 10146788, "latitude": 35.5557, "longitude": -79.3877, "number_of_asthma_cases": 757790, "asthma_cases_per_capita": 0.07468274689487944}, {"state": "North Dakota", "id": 38, "population": 757952, "latitude": 47.4501, "longitude": -100.4659, "number_of_asthma_cases": 46996, "asthma_cases_per_capita": 0.0620039263700076}, {"state": "Ohio", "id": 39, "population": 11614373, "latitude": 40.2862, "longitude": -82.7937, "number_of_asthma_cases": 854186, "asthma_cases_per_capita": 0.0735455973387457}, {"state": "Oklahoma", "id": 40, "population": 3923561, "latitude": 35.5889, "longitude": -97.4943, "number_of_asthma_cases": 307581, "asthma_cases_per_capita": 0.07839332687831284}, {"state": "Oregon", "id": 41, "population": 4093465, "latitude": 43.9336, "longitude": -120.5583, "number_of_asthma_cases": 383340, "asthma_cases_per_capita": 0.09364682487819}, {"state": "Pennsylvania", "id": 42, "population": 12784227, "latitude": 40.8781, "longitude": -77.7996, "number_of_asthma_cases": 1012588, "asthma_cases_per_capita": 0.07920604038085369}, {"state": "Rhode Island", "id": 44, "population": 1056426, "latitude": 41.6762, "longitude": -71.5562, "number_of_asthma_cases": 101251, "asthma_cases_per_capita": 0.09584296486455275}, {"state": "South Carolina", "id": 45, "population": 4961119, "latitude": 33.9169, "longitude": -80.8964, "number_of_asthma_cases": 360353, "asthma_cases_per_capita": 0.07263542761219798}, {"state": "South Dakota", "id": 46, "population": 865454, "latitude": 44.4443, "longitude": -100.2263, "number_of_asthma_cases": 51652, "asthma_cases_per_capita": 0.05968197038779646}, {"state": "Tennessee", "id": 47, "population": 6651194, "latitude": 35.85800000000001, "longitude": -86.3505, "number_of_asthma_cases": 513084, "asthma_cases_per_capita": 0.07714163802769848}, {"state": "Texas", "id": 48, "population": 27862596, "latitude": 31.4757, "longitude": -99.3312, "number_of_asthma_cases": 1572815, "asthma_cases_per_capita": 0.056448975536952835}, {"state": "Utah", "id": 49, "population": 3051217, "latitude": 39.3055, "longitude": -111.6703, "number_of_asthma_cases": 206360, "asthma_cases_per_capita": 0.06763203010470904}, {"state": "Vermont", "id": 50, "population": 624594, "latitude": 44.0687, "longitude": -72.6658, "number_of_asthma_cases": 60216, "asthma_cases_per_capita": 0.09640822678411896}, {"state": "Virginia", "id": 51, "population": 8411808, "latitude": 37.5215, "longitude": -78.8537, "number_of_asthma_cases": 563510, "asthma_cases_per_capita": 0.06699035451118238}, {"state": "Washington", "id": 53, "population": 7288000, "latitude": 47.3826, "longitude": -120.4472, "number_of_asthma_cases": 558951, "asthma_cases_per_capita": 0.07669470362239297}, {"state": "West Virginia", "id": 54, "population": 1831102, "latitude": 38.6409, "longitude": -80.6227, "number_of_asthma_cases": 175368, "asthma_cases_per_capita": 0.09577183575792064}, {"state": "Wisconsin", "id": 55, "population": 5778708, "latitude": 44.6243, "longitude": -89.9941, "number_of_asthma_cases": 408318, "asthma_cases_per_capita": 0.07065904697036085}, {"state": "Wyoming", "id": 56, "population": 585501, "latitude": 42.9957, "longitude": -107.5512, "number_of_asthma_cases": 38099, "asthma_cases_per_capita": 0.06507076845300008}]}}, {"mode": "vega-lite"});
</script>
</div>
</div>
<aside class="notes">
<p>In this choropleth we can see the values of the states in Eastern US are no longer overlapping so it is easier to see the value of each state.</p>
<p>We still have the issue of some states being really small or hard to distinguish, so ideally when using either a choropleth or dots to show values like this, it would be a good idea to complement them with a bar chart in the same figure, which we will see how to do in the next slide deck.</p>
<p>Note that the colorscale does not start at 0. Remember that this is good for highlighting small important differences, but can also give a misleading impression since difference often appear larger than they really are.</p>
<style type="text/css">
        span.MJX_Assistive_MathML {
          position:absolute!important;
          clip: rect(1px, 1px, 1px, 1px);
          padding: 1px 0 0 0!important;
          border: 0!important;
          height: 1px!important;
          width: 1px!important;
          overflow: hidden!important;
          display:block!important;
      }</style></aside>
</section>
<section id="explicitly-setting-the-colour-scale-to-start-from-zero-is-less-misleading" class="slide level2">
<h2>Explicitly setting the colour scale to start from zero is less misleading</h2>
<div id="6a271b64" class="cell" data-execution_count="15">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb15-1"><a aria-hidden="true" tabindex="-1"></a>(alt.Chart(state_map).mark_geoshape().transform_lookup(</span>
<span id="cb15-2"><a aria-hidden="true" tabindex="-1"></a>    lookup<span class="op">=</span><span class="st">'id'</span>,</span>
<span id="cb15-3"><a aria-hidden="true" tabindex="-1"></a>    from_<span class="op">=</span>alt.LookupData(state_pop, <span class="st">'id'</span>, [<span class="st">'asthma_cases_per_capita'</span>]))</span>
<span id="cb15-4"><a aria-hidden="true" tabindex="-1"></a>.encode(color<span class="op">=</span>alt.Color(<span class="st">'asthma_cases_per_capita:Q'</span>, scale<span class="op">=</span>alt.Scale(zero<span class="op">=</span><span class="va">True</span>)))</span>
<span id="cb15-5"><a aria-hidden="true" tabindex="-1"></a>.project(<span class="bu">type</span><span class="op">=</span><span class="st">'albersUsa'</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="15">

<style>
  #altair-viz-574cebedf4b74abdae36a8d883d96290.vega-embed {
    width: 100%;
    display: flex;
  }

  #altair-viz-574cebedf4b74abdae36a8d883d96290.vega-embed details,
  #altair-viz-574cebedf4b74abdae36a8d883d96290.vega-embed details summary {
    position: relative;
  }
</style>
<div id="altair-viz-574cebedf4b74abdae36a8d883d96290"></div>
<script type="text/javascript">
  var VEGA_DEBUG = (typeof VEGA_DEBUG == "undefined") ? {} : VEGA_DEBUG;
  (function(spec, embedOpt){
    let outputDiv = document.currentScript.previousElementSibling;
    if (outputDiv.id !== "altair-viz-574cebedf4b74abdae36a8d883d96290") {
      outputDiv = document.getElementById("altair-viz-574cebedf4b74abdae36a8d883d96290");
    }

    const paths = {
      "vega": "https://cdn.jsdelivr.net/npm/vega@5?noext",
      "vega-lib": "https://cdn.jsdelivr.net/npm/vega-lib?noext",
      "vega-lite": "https://cdn.jsdelivr.net/npm/vega-lite@5.20.1?noext",
      "vega-embed": "https://cdn.jsdelivr.net/npm/vega-embed@6?noext",
    };

    function maybeLoadScript(lib, version) {
      var key = `${lib.replace("-", "")}_version`;
      return (VEGA_DEBUG[key] == version) ?
        Promise.resolve(paths[lib]) :
        new Promise(function(resolve, reject) {
          var s = document.createElement('script');
          document.getElementsByTagName("head")[0].appendChild(s);
          s.async = true;
          s.onload = () => {
            VEGA_DEBUG[key] = version;
            return resolve(paths[lib]);
          };
          s.onerror = () => reject(`Error loading script: ${paths[lib]}`);
          s.src = paths[lib];
        });
    }

    function showError(err) {
      outputDiv.innerHTML = `<div class="error" style="color:red;">${err}</div>`;
      throw err;
    }

    function displayChart(vegaEmbed) {
      vegaEmbed(outputDiv, spec, embedOpt)
        .catch(err => showError(`Javascript Error: ${err.message}<br>This usually means there's a typo in your chart specification. See the javascript console for the full traceback.`));
    }

    if(typeof define === "function" && define.amd) {
      requirejs.config({paths});
      let deps = ["vega-embed"];
      require(deps, displayChart, err => showError(`Error loading script: ${err.message}`));
    } else {
      maybeLoadScript("vega", "5")
        .then(() => maybeLoadScript("vega-lite", "5.20.1"))
        .then(() => maybeLoadScript("vega-embed", "6"))
        .catch(showError)
        .then(() => displayChart(vegaEmbed));
    }
  })({"config": {"view": {"continuousWidth": 300, "continuousHeight": 300}, "legend": {"titleFontSize": 13, "labelFontSize": 12}, "axis": {"titleFontSize": 13, "labelFontSize": 12}, "header": {"titleFontSize": 15, "labelFontSize": 13}}, "data": {"url": "https://cdn.jsdelivr.net/npm/vega-datasets@v1.29.0/data/us-10m.json", "format": {"feature": "states", "type": "topojson"}}, "mark": {"type": "geoshape"}, "encoding": {"color": {"field": "asthma_cases_per_capita", "scale": {"zero": true}, "type": "quantitative"}}, "projection": {"type": "albersUsa"}, "transform": [{"lookup": "id", "from": {"data": {"name": "data-4acfa937387f9b7b32d43a126af5b75d"}, "key": "id", "fields": ["asthma_cases_per_capita"]}}], "$schema": "https://vega.github.io/schema/vega-lite/v5.20.1.json", "datasets": {"data-4acfa937387f9b7b32d43a126af5b75d": [{"state": "Alabama", "id": 1, "population": 4863300, "latitude": 32.7794, "longitude": -86.8287, "number_of_asthma_cases": 394634, "asthma_cases_per_capita": 0.0811453128534123}, {"state": "Alaska", "id": 2, "population": 741894, "latitude": 64.0685, "longitude": -152.2782, "number_of_asthma_cases": 50685, "asthma_cases_per_capita": 0.06831838510622812}, {"state": "Arizona", "id": 4, "population": 6931071, "latitude": 34.2744, "longitude": -111.6602, "number_of_asthma_cases": 545104, "asthma_cases_per_capita": 0.07864643141009521}, {"state": "Arkansas", "id": 5, "population": 2988248, "latitude": 34.8938, "longitude": -92.4426, "number_of_asthma_cases": 225853, "asthma_cases_per_capita": 0.0755804069809467}, {"state": "California", "id": 6, "population": 39250017, "latitude": 37.1841, "longitude": -119.4696, "number_of_asthma_cases": 2607598, "asthma_cases_per_capita": 0.06643558905974487}, {"state": "Colorado", "id": 8, "population": 5540545, "latitude": 38.9972, "longitude": -105.5478, "number_of_asthma_cases": 399357, "asthma_cases_per_capita": 0.07207901027786978}, {"state": "Connecticut", "id": 9, "population": 3576452, "latitude": 41.6219, "longitude": -72.7273, "number_of_asthma_cases": 290278, "asthma_cases_per_capita": 0.0811636784164865}, {"state": "Delaware", "id": 10, "population": 952065, "latitude": 38.9896, "longitude": -75.505, "number_of_asthma_cases": 77035, "asthma_cases_per_capita": 0.08091359308450578}, {"state": "District of Columbia", "id": 11, "population": 681170, "latitude": 38.9101, "longitude": -77.0147, "number_of_asthma_cases": 66441, "asthma_cases_per_capita": 0.0975395275775504}, {"state": "Florida", "id": 12, "population": 20612439, "latitude": 28.6305, "longitude": -82.4497, "number_of_asthma_cases": 1495632, "asthma_cases_per_capita": 0.07255968107413198}, {"state": "Georgia", "id": 13, "population": 10310371, "latitude": 32.6415, "longitude": -83.4426, "number_of_asthma_cases": 714569, "asthma_cases_per_capita": 0.06930584748114302}, {"state": "Hawaii", "id": 15, "population": 1428557, "latitude": 20.2927, "longitude": -156.3737, "number_of_asthma_cases": 104368, "asthma_cases_per_capita": 0.07305833788921268}, {"state": "Idaho", "id": 16, "population": 1683140, "latitude": 44.3509, "longitude": -114.613, "number_of_asthma_cases": 111954, "asthma_cases_per_capita": 0.06651496607531163}, {"state": "Illinois", "id": 17, "population": 12801539, "latitude": 40.0417, "longitude": -89.1965, "number_of_asthma_cases": 860007, "asthma_cases_per_capita": 0.06717996953335063}, {"state": "Indiana", "id": 18, "population": 6633053, "latitude": 39.8942, "longitude": -86.2816, "number_of_asthma_cases": 509651, "asthma_cases_per_capita": 0.07683505619508844}, {"state": "Iowa", "id": 19, "population": 3134693, "latitude": 42.0751, "longitude": -93.496, "number_of_asthma_cases": 190960, "asthma_cases_per_capita": 0.06091824622060278}, {"state": "Kansas", "id": 20, "population": 2907289, "latitude": 38.4937, "longitude": -98.3804, "number_of_asthma_cases": 214698, "asthma_cases_per_capita": 0.07384817952394826}, {"state": "Kentucky", "id": 21, "population": 4436974, "latitude": 37.5347, "longitude": -85.3021, "number_of_asthma_cases": 395345, "asthma_cases_per_capita": 0.08910239275686538}, {"state": "Louisiana", "id": 22, "population": 4681666, "latitude": 31.0689, "longitude": -91.9968, "number_of_asthma_cases": 316423, "asthma_cases_per_capita": 0.06758769207371905}, {"state": "Maine", "id": 23, "population": 1331479, "latitude": 45.3695, "longitude": -69.2428, "number_of_asthma_cases": 132126, "asthma_cases_per_capita": 0.09923250760995855}, {"state": "Maryland", "id": 24, "population": 6016447, "latitude": 39.055, "longitude": -76.7909, "number_of_asthma_cases": 439909, "asthma_cases_per_capita": 0.07311773875843999}, {"state": "Massachusetts", "id": 25, "population": 6811779, "latitude": 42.2596, "longitude": -71.8083, "number_of_asthma_cases": 558435, "asthma_cases_per_capita": 0.08198078651700239}, {"state": "Michigan", "id": 26, "population": 9928300, "latitude": 44.3467, "longitude": -85.4102, "number_of_asthma_cases": 872519, "asthma_cases_per_capita": 0.08788201404067161}, {"state": "Minnesota", "id": 27, "population": 5519952, "latitude": 46.2807, "longitude": -94.3053, "number_of_asthma_cases": 357232, "asthma_cases_per_capita": 0.064716504781201}, {"state": "Mississippi", "id": 28, "population": 2988726, "latitude": 32.7364, "longitude": -89.6678, "number_of_asthma_cases": 218223, "asthma_cases_per_capita": 0.07301539184254428}, {"state": "Missouri", "id": 29, "population": 6093000, "latitude": 38.3566, "longitude": -92.458, "number_of_asthma_cases": 444334, "asthma_cases_per_capita": 0.07292532414245856}, {"state": "Montana", "id": 30, "population": 1042520, "latitude": 47.0527, "longitude": -109.6333, "number_of_asthma_cases": 82660, "asthma_cases_per_capita": 0.07928864674059011}, {"state": "Nebraska", "id": 31, "population": 1907116, "latitude": 41.5378, "longitude": -99.7951, "number_of_asthma_cases": 128793, "asthma_cases_per_capita": 0.06753286113692088}, {"state": "Nevada", "id": 32, "population": 2940058, "latitude": 39.3289, "longitude": -116.6312, "number_of_asthma_cases": 186787, "asthma_cases_per_capita": 0.06353173985003017}, {"state": "New Hampshire", "id": 33, "population": 1334795, "latitude": 43.6805, "longitude": -71.5811, "number_of_asthma_cases": 128307, "asthma_cases_per_capita": 0.09612487310785552}, {"state": "New Jersey", "id": 34, "population": 8944469, "latitude": 40.1907, "longitude": -74.6728, "number_of_asthma_cases": 593242, "asthma_cases_per_capita": 0.06632501046177253}, {"state": "New Mexico", "id": 35, "population": 2081015, "latitude": 34.4071, "longitude": -106.1126, "number_of_asthma_cases": 157177, "asthma_cases_per_capita": 0.07552900868086006}, {"state": "New York", "id": 36, "population": 19745289, "latitude": 42.9538, "longitude": -75.5268, "number_of_asthma_cases": 1578011, "asthma_cases_per_capita": 0.07991835419577804}, {"state": "North Carolina", "id": 37, "population": 10146788, "latitude": 35.5557, "longitude": -79.3877, "number_of_asthma_cases": 757790, "asthma_cases_per_capita": 0.07468274689487944}, {"state": "North Dakota", "id": 38, "population": 757952, "latitude": 47.4501, "longitude": -100.4659, "number_of_asthma_cases": 46996, "asthma_cases_per_capita": 0.0620039263700076}, {"state": "Ohio", "id": 39, "population": 11614373, "latitude": 40.2862, "longitude": -82.7937, "number_of_asthma_cases": 854186, "asthma_cases_per_capita": 0.0735455973387457}, {"state": "Oklahoma", "id": 40, "population": 3923561, "latitude": 35.5889, "longitude": -97.4943, "number_of_asthma_cases": 307581, "asthma_cases_per_capita": 0.07839332687831284}, {"state": "Oregon", "id": 41, "population": 4093465, "latitude": 43.9336, "longitude": -120.5583, "number_of_asthma_cases": 383340, "asthma_cases_per_capita": 0.09364682487819}, {"state": "Pennsylvania", "id": 42, "population": 12784227, "latitude": 40.8781, "longitude": -77.7996, "number_of_asthma_cases": 1012588, "asthma_cases_per_capita": 0.07920604038085369}, {"state": "Rhode Island", "id": 44, "population": 1056426, "latitude": 41.6762, "longitude": -71.5562, "number_of_asthma_cases": 101251, "asthma_cases_per_capita": 0.09584296486455275}, {"state": "South Carolina", "id": 45, "population": 4961119, "latitude": 33.9169, "longitude": -80.8964, "number_of_asthma_cases": 360353, "asthma_cases_per_capita": 0.07263542761219798}, {"state": "South Dakota", "id": 46, "population": 865454, "latitude": 44.4443, "longitude": -100.2263, "number_of_asthma_cases": 51652, "asthma_cases_per_capita": 0.05968197038779646}, {"state": "Tennessee", "id": 47, "population": 6651194, "latitude": 35.85800000000001, "longitude": -86.3505, "number_of_asthma_cases": 513084, "asthma_cases_per_capita": 0.07714163802769848}, {"state": "Texas", "id": 48, "population": 27862596, "latitude": 31.4757, "longitude": -99.3312, "number_of_asthma_cases": 1572815, "asthma_cases_per_capita": 0.056448975536952835}, {"state": "Utah", "id": 49, "population": 3051217, "latitude": 39.3055, "longitude": -111.6703, "number_of_asthma_cases": 206360, "asthma_cases_per_capita": 0.06763203010470904}, {"state": "Vermont", "id": 50, "population": 624594, "latitude": 44.0687, "longitude": -72.6658, "number_of_asthma_cases": 60216, "asthma_cases_per_capita": 0.09640822678411896}, {"state": "Virginia", "id": 51, "population": 8411808, "latitude": 37.5215, "longitude": -78.8537, "number_of_asthma_cases": 563510, "asthma_cases_per_capita": 0.06699035451118238}, {"state": "Washington", "id": 53, "population": 7288000, "latitude": 47.3826, "longitude": -120.4472, "number_of_asthma_cases": 558951, "asthma_cases_per_capita": 0.07669470362239297}, {"state": "West Virginia", "id": 54, "population": 1831102, "latitude": 38.6409, "longitude": -80.6227, "number_of_asthma_cases": 175368, "asthma_cases_per_capita": 0.09577183575792064}, {"state": "Wisconsin", "id": 55, "population": 5778708, "latitude": 44.6243, "longitude": -89.9941, "number_of_asthma_cases": 408318, "asthma_cases_per_capita": 0.07065904697036085}, {"state": "Wyoming", "id": 56, "population": 585501, "latitude": 42.9957, "longitude": -107.5512, "number_of_asthma_cases": 38099, "asthma_cases_per_capita": 0.06507076845300008}]}}, {"mode": "vega-lite"});
</script>
</div>
</div>
<aside class="notes">
<p>A cut of scale is often less of an issue with color than with an axis, since we need to look at the colorbar anyways in order to interpret the different colors.</p>
<p>However, it can still be a good idea to set the scale to explicitly start from zero to more truly represent the data and the relative differences between states.</p>
<p>We can do this using <code>alt.Scale(zero=True)</code> as shown in this slide.</p>
<style type="text/css">
        span.MJX_Assistive_MathML {
          position:absolute!important;
          clip: rect(1px, 1px, 1px, 1px);
          padding: 1px 0 0 0!important;
          border: 0!important;
          height: 1px!important;
          width: 1px!important;
          overflow: hidden!important;
          display:block!important;
      }</style></aside>
</section>
<section id="lets-apply-what-we-learned" class="title-slide slide level1 center">
<h1>Let’s apply what we learned!</h1>


</section>
    </div>
  <div class="quarto-auto-generated-content" style="display: none;">
<div class="footer footer-default">

</div>
</div></div>

  <script>window.backupDefine = window.define; window.define = undefined;</script>
  <script src="../../../site_libs/revealjs/dist/reveal.js"></script>
  <!-- reveal.js plugins -->
  <script src="../../../site_libs/revealjs/plugin/quarto-line-highlight/line-highlight.js"></script>
  <script src="../../../site_libs/revealjs/plugin/pdf-export/pdfexport.js"></script>
  <script src="../../../site_libs/revealjs/plugin/reveal-menu/menu.js"></script>
  <script src="../../../site_libs/revealjs/plugin/reveal-menu/quarto-menu.js"></script>
  <script src="../../../site_libs/revealjs/plugin/quarto-support/support.js"></script>
  

  <script src="../../../site_libs/revealjs/plugin/notes/notes.js"></script>
  <script src="../../../site_libs/revealjs/plugin/search/search.js"></script>
  <script src="../../../site_libs/revealjs/plugin/zoom/zoom.js"></script>
  <script src="../../../site_libs/revealjs/plugin/math/math.js"></script>
  <script>window.define = window.backupDefine; window.backupDefine = undefined;</script>

  <script>

      // Full list of configuration options available at:
      // https://revealjs.com/config/
      Reveal.initialize({
'controlsAuto': true,
'previewLinksAuto': false,
'pdfSeparateFragments': false,
'autoAnimateEasing': "ease",
'autoAnimateDuration': 1,
'autoAnimateUnmatched': true,
'jumpToSlide': true,
'menu': {"side":"left","useTextContentForMissingTitles":true,"markers":false,"loadIcons":false,"custom":[{"title":"Tools","icon":"<i class=\"fas fa-gear\"></i>","content":"<ul class=\"slide-menu-items\">\n<li class=\"slide-tool-item active\" data-item=\"0\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.fullscreen(event)\"><kbd>f</kbd> Fullscreen</a></li>\n<li class=\"slide-tool-item\" data-item=\"1\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.speakerMode(event)\"><kbd>s</kbd> Speaker View</a></li>\n<li class=\"slide-tool-item\" data-item=\"2\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.overview(event)\"><kbd>o</kbd> Slide Overview</a></li>\n<li class=\"slide-tool-item\" data-item=\"3\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.togglePdfExport(event)\"><kbd>e</kbd> PDF Export Mode</a></li>\n<li class=\"slide-tool-item\" data-item=\"4\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.toggleScrollView(event)\"><kbd>r</kbd> Scroll View Mode</a></li>\n<li class=\"slide-tool-item\" data-item=\"5\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.keyboardHelp(event)\"><kbd>?</kbd> Keyboard Help</a></li>\n</ul>"}],"openButton":false},
'smaller': false,
 
        // Display controls in the bottom right corner
        controls: false,

        // Help the user learn the controls by providing hints, for example by
        // bouncing the down arrow when they first encounter a vertical slide
        controlsTutorial: false,

        // Determines where controls appear, "edges" or "bottom-right"
        controlsLayout: 'bottom-right',

        // Visibility rule for backwards navigation arrows; "faded", "hidden"
        // or "visible"
        controlsBackArrows: 'faded',

        // Display a presentation progress bar
        progress: false,

        // Display the page number of the current slide
        slideNumber: 'c/t',

        // 'all', 'print', or 'speaker'
        showSlideNumber: 'all',

        // Add the current slide number to the URL hash so that reloading the
        // page/copying the URL will return you to the same slide
        hash: true,

        // Start with 1 for the hash rather than 0
        hashOneBasedIndex: false,

        // Flags if we should monitor the hash and change slides accordingly
        respondToHashChanges: true,

        // Push each slide change to the browser history
        history: false,

        // Enable keyboard shortcuts for navigation
        keyboard: true,

        // Enable the slide overview mode
        overview: true,

        // Disables the default reveal.js slide layout (scaling and centering)
        // so that you can use custom CSS layout
        disableLayout: false,

        // Vertical centering of slides
        center: false,

        // Enables touch navigation on devices with touch input
        touch: true,

        // Loop the presentation
        loop: false,

        // Change the presentation direction to be RTL
        rtl: false,

        // see https://revealjs.com/vertical-slides/#navigation-mode
        navigationMode: 'linear',

        // Randomizes the order of slides each time the presentation loads
        shuffle: false,

        // Turns fragments on and off globally
        fragments: true,

        // Flags whether to include the current fragment in the URL,
        // so that reloading brings you to the same fragment position
        fragmentInURL: false,

        // Flags if the presentation is running in an embedded mode,
        // i.e. contained within a limited portion of the screen
        embedded: false,

        // Flags if we should show a help overlay when the questionmark
        // key is pressed
        help: true,

        // Flags if it should be possible to pause the presentation (blackout)
        pause: true,

        // Flags if speaker notes should be visible to all viewers
        showNotes: true,

        // Global override for autoplaying embedded media (null/true/false)
        autoPlayMedia: null,

        // Global override for preloading lazy-loaded iframes (null/true/false)
        preloadIframes: null,

        // Number of milliseconds between automatically proceeding to the
        // next slide, disabled when set to 0, this value can be overwritten
        // by using a data-autoslide attribute on your slides
        autoSlide: 0,

        // Stop auto-sliding after user input
        autoSlideStoppable: true,

        // Use this method for navigation when auto-sliding
        autoSlideMethod: null,

        // Specify the average time in seconds that you think you will spend
        // presenting each slide. This is used to show a pacing timer in the
        // speaker view
        defaultTiming: null,

        // Enable slide navigation via mouse wheel
        mouseWheel: false,

        // The display mode that will be used to show slides
        display: 'block',

        // Hide cursor if inactive
        hideInactiveCursor: true,

        // Time before the cursor is hidden (in ms)
        hideCursorTime: 5000,

        // Opens links in an iframe preview overlay
        previewLinks: false,

        // Transition style (none/fade/slide/convex/concave/zoom)
        transition: 'slide',

        // Transition speed (default/fast/slow)
        transitionSpeed: 'default',

        // Transition style for full page slide backgrounds
        // (none/fade/slide/convex/concave/zoom)
        backgroundTransition: 'none',

        // Number of slides away from the current that are visible
        viewDistance: 3,

        // Number of slides away from the current that are visible on mobile
        // devices. It is advisable to set this to a lower number than
        // viewDistance in order to save resources.
        mobileViewDistance: 2,

        // The "normal" size of the presentation, aspect ratio will be preserved
        // when the presentation is scaled to fit different resolutions. Can be
        // specified using percentage units.
        width: '100%',

        height: 700,

        // Factor of the display size that should remain empty around the content
        margin: 0.1,

        math: {
          mathjax: 'https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/MathJax.js',
          config: 'TeX-AMS_HTML-full',
          tex2jax: {
            inlineMath: [['\\(','\\)']],
            displayMath: [['\\[','\\]']],
            balanceBraces: true,
            processEscapes: false,
            processRefs: true,
            processEnvironments: true,
            preview: 'TeX',
            skipTags: ['script','noscript','style','textarea','pre','code'],
            ignoreClass: 'tex2jax_ignore',
            processClass: 'tex2jax_process'
          },
        },

        // reveal.js plugins
        plugins: [QuartoLineHighlight, PdfExport, RevealMenu, QuartoSupport,

          RevealMath,
          RevealNotes,
          RevealSearch,
          RevealZoom
        ]
      });
    </script>
    <script id="quarto-html-after-body" type="application/javascript">
    window.document.addEventListener("DOMContentLoaded", function (event) {
      const toggleBodyColorMode = (bsSheetEl) => {
        const mode = bsSheetEl.getAttribute("data-mode");
        const bodyEl = window.document.querySelector("body");
        if (mode === "dark") {
          bodyEl.classList.add("quarto-dark");
          bodyEl.classList.remove("quarto-light");
        } else {
          bodyEl.classList.add("quarto-light");
          bodyEl.classList.remove("quarto-dark");
        }
      }
      const toggleBodyColorPrimary = () => {
        const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
        if (bsSheetEl) {
          toggleBodyColorMode(bsSheetEl);
        }
      }
      toggleBodyColorPrimary();  
      const tabsets =  window.document.querySelectorAll(".panel-tabset-tabby")
      tabsets.forEach(function(tabset) {
        const tabby = new Tabby('#' + tabset.id);
      });
      const isCodeAnnotation = (el) => {
        for (const clz of el.classList) {
          if (clz.startsWith('code-annotation-')) {                     
            return true;
          }
        }
        return false;
      }
      const onCopySuccess = function(e) {
        // button target
        const button = e.trigger;
        // don't keep focus
        button.blur();
        // flash "checked"
        button.classList.add('code-copy-button-checked');
        var currentTitle = button.getAttribute("title");
        button.setAttribute("title", "Copied!");
        let tooltip;
        if (window.bootstrap) {
          button.setAttribute("data-bs-toggle", "tooltip");
          button.setAttribute("data-bs-placement", "left");
          button.setAttribute("data-bs-title", "Copied!");
          tooltip = new bootstrap.Tooltip(button, 
            { trigger: "manual", 
              customClass: "code-copy-button-tooltip",
              offset: [0, -8]});
          tooltip.show();    
        }
        setTimeout(function() {
          if (tooltip) {
            tooltip.hide();
            button.removeAttribute("data-bs-title");
            button.removeAttribute("data-bs-toggle");
            button.removeAttribute("data-bs-placement");
          }
          button.setAttribute("title", currentTitle);
          button.classList.remove('code-copy-button-checked');
        }, 1000);
        // clear code selection
        e.clearSelection();
      }
      const getTextToCopy = function(trigger) {
          const codeEl = trigger.previousElementSibling.cloneNode(true);
          for (const childEl of codeEl.children) {
            if (isCodeAnnotation(childEl)) {
              childEl.remove();
            }
          }
          return codeEl.innerText;
      }
      const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
        text: getTextToCopy
      });
      clipboard.on('success', onCopySuccess);
      if (window.document.getElementById('quarto-embedded-source-code-modal')) {
        const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
          text: getTextToCopy,
          container: window.document.getElementById('quarto-embedded-source-code-modal')
        });
        clipboardModal.on('success', onCopySuccess);
      }
        var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
        var mailtoRegex = new RegExp(/^mailto:/);
          var filterRegex = new RegExp('/' + window.location.host + '/');
        var isInternal = (href) => {
            return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
        }
        // Inspect non-navigation links and adorn them if external
     	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
        for (var i=0; i<links.length; i++) {
          const link = links[i];
          if (!isInternal(link.href)) {
            // undo the damage that might have been done by quarto-nav.js in the case of
            // links that we want to consider external
            if (link.dataset.originalHref !== undefined) {
              link.href = link.dataset.originalHref;
            }
          }
        }
      function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
        const config = {
          allowHTML: true,
          maxWidth: 500,
          delay: 100,
          arrow: false,
          appendTo: function(el) {
              return el.closest('section.slide') || el.parentElement;
          },
          interactive: true,
          interactiveBorder: 10,
          theme: 'light-border',
          placement: 'bottom-start',
        };
        if (contentFn) {
          config.content = contentFn;
        }
        if (onTriggerFn) {
          config.onTrigger = onTriggerFn;
        }
        if (onUntriggerFn) {
          config.onUntrigger = onUntriggerFn;
        }
          config['offset'] = [0,0];
          config['maxWidth'] = 700;
        window.tippy(el, config); 
      }
      const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
      for (var i=0; i<noterefs.length; i++) {
        const ref = noterefs[i];
        tippyHover(ref, function() {
          // use id or data attribute instead here
          let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
          try { href = new URL(href).hash; } catch {}
          const id = href.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note) {
            return note.innerHTML;
          } else {
            return "";
          }
        });
      }
      const findCites = (el) => {
        const parentEl = el.parentElement;
        if (parentEl) {
          const cites = parentEl.dataset.cites;
          if (cites) {
            return {
              el,
              cites: cites.split(' ')
            };
          } else {
            return findCites(el.parentElement)
          }
        } else {
          return undefined;
        }
      };
      var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
      for (var i=0; i<bibliorefs.length; i++) {
        const ref = bibliorefs[i];
        const citeInfo = findCites(ref);
        if (citeInfo) {
          tippyHover(citeInfo.el, function() {
            var popup = window.document.createElement('div');
            citeInfo.cites.forEach(function(cite) {
              var citeDiv = window.document.createElement('div');
              citeDiv.classList.add('hanging-indent');
              citeDiv.classList.add('csl-entry');
              var biblioDiv = window.document.getElementById('ref-' + cite);
              if (biblioDiv) {
                citeDiv.innerHTML = biblioDiv.innerHTML;
              }
              popup.appendChild(citeDiv);
            });
            return popup.innerHTML;
          });
        }
      }
    });
    </script>
    

</body></html>